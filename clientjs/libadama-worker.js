console.log("adama worker started"),self.addEventListener("push",function(o){if(o.data){var t=o.data.json();if(t){console.log(t);var n="NA",i=("@pt"in t&&(n=t["@pt"]),{body:t.body||"Generic Push Body"}),a=(t.icon&&(i.icon=t.icon),!0),e=(t.hide&&(a=!1),{});if(t.url&&(e.url=t.url),i.data=e,a&&o.waitUntil(self.registration.showNotification(t.title||"Generic Push Title",i)),"number"==typeof t.badge&&navigator.setAppBadge)try{o.waitUntil(navigator.setAppBadge(t.badge))}catch(o){}try{o.waitUntil(fetch(self.location.protocol+"//"+self.location.host+"/~pt/"+n,{method:"PUT",headers:{},body:n}))}catch(o){console.log(o)}}}}),self.addEventListener("notificationclick",function(o){var e,l;o.notification&&o.notification.data&&o.notification.data.url&&(e=self.location.protocol+"//"+self.location.host+o.notification.data.url,l=self.location.protocol+"//"+self.location.host,o.notification.close(),o.waitUntil(clients.matchAll({type:"window"}).then(o=>{for(var t=null,n=null,i=0;i<o.length;i++){var a=o[i];if(console.log("client:"+a.url+";"+e),a.url===e&&"focus"in a)return a.focus();a.url.startsWith(e)&&"navigate"in a&&(t=a),a.url.startsWith(l)&&"navigate"in a&&(n=a)}return null!=t?(console.log("nav:prefix:"+e),t.navigate(e)):null!=n?(console.log("nav:home:"+e),n.navigate(e)):clients.openWindow?(console.log("open:new:"+e),clients.openWindow(e)):void 0})))});
