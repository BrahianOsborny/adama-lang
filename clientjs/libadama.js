function AdamaTree(){function i(e){if(Array.isArray(e))for(var t=[],n=0;n<e.length;n++)t.push(i(e[n]));else{if("object"!=typeof e)return e;t={};for(key in e)"#"!=key[0]&&"__key"!=key&&"@o"!=key&&"@s"!=key&&(t[key]=i(e[key]))}return t}function O(e,t){if(0==e.length)return e;for(var n=[],i=0;i<e.length;i++)t in e[i]&&n.push(e[i][t]);return n}function N(e,t,n){for(var i=0;i<e.length;i++){var r=e[i];if("@e"in r)for(var o=r["@e"],a=0;a<o.length;a++)n.push(function(){this.f(this.v)}.bind({f:o[a],v:t}))}}function R(e,t,n,i,r){if(!r||0!=n.length){for(var o in t){var a="#"+o,s=e[o],c=t[o];if(null==c)Array.isArray(s)&&(a in e&&U(O(n,a)),delete e[a]),U(O(n,o)),delete e[o];else if("object"!=typeof c||Array.isArray(c))e[o]=c,N(O(n,o),c,i);else if(Array.isArray(s)||"@o"in c||"@s"in c){o in e||(e[o]=[]),a in e||(e[a]={},"@o"in c&&(e[a]["@o"]=!0),e[a].__key=o);var u,d=e[a],f=O(n,o),l=null,h=null,_={};for(u in c){var p=c[u];if("@o"==u)l=p;else if("@s"==u)h=p;else if(null==p)u in d&&(_[u]=function(e){U(O(f,e)),delete d[e],L(f,e);for(var t=f,n=e,i=0;i<t.length;i++){var r=t[i];if("-"in r){r=r["-"];if("@e"in r)for(var o=r["@e"],a=0;a<o.length;a++)o[a](n)}}});else{if(!(u in d)){x=b=w=g=y=void 0;for(var v=f,m=u,y=0;y<v.length;y++){var g=v[y];if("+"in g){var w=g["+"];if("@e"in w)for(var b=w["@e"],x=0;x<b.length;x++)P(g,b[x](m),m)}}}p=c[u];"object"==typeof p?(u in d||(d[u]={},d[u].__key=u),_[u]=function(e){R(d[e],c[e],O(f,e),i,r),N(O(f,e),d[e],i)}):(d[u]=p,_[u]=function(e){N(O(f,e),d[e],i)})}}var k=e[o],S=[];if(null!=l){for(var D=[],A=[],q=0;q<l.length;q++){var C=l[q],T=typeof C;if("string"==T||"number"==T)D.push(d[C]),A.push(""+C);else for(var T=C[0],I=C[1],E=T;E<=I;E++)k[E]&&(D.push(k[E]),A.push(k[E].__key))}S.push(function(){N(O(f,"~"),A,i)}),e[o]=D}else if(null!=h){for(D=[],A=[],q=0;q<h;q++)D[q]=d[""+q],A.push(""+q);S.push(function(){N(O(f,"~"),A,i)}),e[o]=D}for(u in _)_[u](u);for(q=0;q<S.length;q++)S[q]();N(f,e[o],i)}else{o in e&&"object"==typeof e[o]||(e[o]={});s=O(n,o);R(e[o],c,s,i,r),N(s,e[o],i)}}N(n,e,i)}}function a(e){for(var t=0;t<e.length;t++)e[t]()}function r(e,t){if(Array.isArray(e))for(var n=0;n<e.length;n++)r(e[n],t);else if("object"==typeof e)for(var i in e)"@e"==i?r(e[i],t):(i in t||(t[i]={}),r(e[i],t[i]));else"function"==typeof e&&("@e"in t?t["@e"].push(e):t["@e"]=[e])}var o=0,s={},c={},P=(this.nuke=function(){c={}},this.copy=function(){return i(s)},this.str=function(){return JSON.stringify(s)},this.raw=function(){return s},function(e,t,n){if(Array.isArray(t))for(var i=0;i<t.length;i++)P(e,t[i],n);else if("function"==typeof t)n in e||(e[n]={}),"@e"in(o=e[n])?o["@e"].push(t):o["@e"]=[t];else if("object"==typeof t){n in e||(e[n]={});var r,o=e[n];for(r in t)"@e"==r?P(e,t[r],n):P(o,t[r],r)}}),U=function(e){if(Array.isArray(e))for(var t=e.length,n=0;n<t;n++)U(e[n]);else if("object"==typeof e)for(var i in e)if("+"!=i&&"-"!=i){var r=e[i];if("@e"==i)for(var o=0;o<r.length;o++)r[o](null);else U(r)}},L=function(e,t){if(Array.isArray(e))for(var n=e.length,i=0;i<n;i++)L(e[i],t);else"object"==typeof e&&t in e&&delete e[t]},u=(this.update_in_progress=!1,this.update=function(e){this.update_in_progress=!0;var t=[];for(o in c)t.push(c[o]);var n=[];for(R(s,e,t,n,!1),a(n);0<this.subscribe_delay.length;){for(var i=this.subscribe_delay,r=(this.subscribe_delay=[],[]),o=0;o<i.length;o++)i[o].aborted||r.push(i[o].sub);n=[],R({},u(s),r,n,!0),a(n)}this.update_in_progress=!1},function(e){var t,n={};for(t in e)if("#"!=t[0]&&"@o"!=t&&"__key"!=t){var i=e[t];if("#"+t in e){var r=e["#"+t],o={};if("@o"in r){for(var a=[],s=0;s<i.length;s++){var c=i[s];o[c.__key]=u(c),a.push(i[s].__key)}o["@o"]=a}else{for(s=0;s<i.length;s++)o[""+s]=u(r[s]);o["@s"]=i.length}n[t]=o}else n[t]="object"==typeof i?u(i):i}return n});this.subscribe_delay=[],this.subscribe=function(e){var t,n={},i=(r(e,n),""+o++);return c[i]=n,this.update_in_progress?((t={}).sub=n,t.aborted=!1,this.subscribe_delay.push(t),function(){t.aborted=!0,delete c[i]}):(e=u(s),R({},e,[n],e=[],!0),a(e),function(){delete c[i]})}}class WebSocketAdamaConnection{constructor(e){this.backoff=1,this.host=e,this.url="wss://"+e+"/~s",this.connected=!1,this.assets=!0,this.dead=!1,this.maximum_backoff=5e3,this.reset_backoff=1e3,this.socket=null,this.onstatuschange=function(e){},this.onping=function(e,t){},this.scheduled=!1,this.callbacks=new Map,this.nextId=0,this.onreconnect=new Map}stop(){this.dead=!0,null!==this.socket&&this.socket.close()}_retry(){var e,t;this.socket=null,this.connected&&(this.connected=!1,this.onstatuschange(!1)),this.callbacks.clear(),this.dead||this.scheduled||(e=!1,this.backoff+=Math.random()*this.backoff,this.backoff>this.maximum_backoff&&(this.backoff=this.maximum_backoff,e=!0),this.scheduled=!0,t=this,setTimeout(function(){t.start()},this.backoff),e&&(this.backoff/=2))}start(){var n=this;this.scheduled=!1,this.dead=!1,this.socket=new WebSocket(this.url),this.socket.onmessage=function(e){var t,e=JSON.parse(e.data);{if(!("ping"in e))return"status"in e?"connected"!=e.status?(n.socket.close(),n.socket=null,n.backoff=n.reset_backoff,void n._retry()):(n.backoff=1,n.connected=!0,n.assets=e.assets,n.onstatuschange(!0),n._reconnect(),void n.ConfigureMakeOrGetAssetKey({success:function(e){try{var t=new XMLHttpRequest;t.open("GET","https://"+n.host+"/~p"+e.assetKey,!0),t.withCredentials=!0,t.send()}catch(e){console.log(e)}},failure:function(){}})):void("failure"in e?n.callbacks.has(e.failure)&&(t=n.callbacks.get(e.failure))&&(n.callbacks.delete(e.failure),t(e)):"deliver"in e&&n.callbacks.has(e.deliver)&&(t=n.callbacks.get(e.deliver))&&(e.done&&n.callbacks.delete(e.deliver),t(e)));n.onping(e.ping,e.latency),e.pong=(new Date).getTime()/1e3,n.socket.send(JSON.stringify(e))}},this.socket.onclose=function(e){n._retry()},this.socket.onerror=function(e){n._retry()}}_write(e,t){return this.connected?(this.callbacks.set(e.id,t),this.socket.send(JSON.stringify(e)),!0):(t({failure:600,reason:999}),!1)}async wait_connected(){var n,i;return this.connected?new Promise(function(e){e(!0)}):(i=(n=this).onstatuschange,new Promise(function(t){n.onstatuschange=function(e){i(e),e&&(t(!0),n.onstatuschange=i)}}))}_reconnect(){this.onreconnect.forEach(function(e,t){e.__retry()})}__execute_rr(t){var n=this;return t.first=!0,n._write(t.request,function(e){t.first&&(t.first=!1,"failure"in e?"failure"in t.responder&&t.responder.failure(e.reason):"success"in t.responder&&t.responder.success(e.response)),n.onreconnect.delete(t.id)})?(n.onreconnect.set(t.id,t),t.__retry=function(){n.__execute_rr(t)},t):null}__execute_stream(t){var n=this;return n._write(t.request,function(e){"failure"in e?("failure"in t.responder&&t.responder.failure(e.reason),n.onreconnect.delete(t.id)):(e.response&&"next"in t.responder&&t.responder.next(e.response),e.done&&("complete"in t.responder&&t.responder.complete(),n.onreconnect.delete(t.id)))})?(n.onreconnect.set(t.id,t),t.__retry=function(){n.__execute_stream(t)},t):null}__id(){return this.nextId++,this.nextId}InitSetupAccount(e,t){var n=this.__id();return this.__execute_rr({id:n,responder:t,request:{method:"init/setup-account",id:n,email:e}})}InitConvertGoogleUser(e,t){var n=this.__id();return this.__execute_rr({id:n,responder:t,request:{method:"init/convert-google-user",id:n,"access-token":e}})}InitCompleteAccount(e,t,n,i){var r=this.__id();return this.__execute_rr({id:r,responder:i,request:{method:"init/complete-account",id:r,email:e,revoke:t,code:n}})}Deinit(e,t){var n=this.__id();return this.__execute_rr({id:n,responder:t,request:{method:"deinit",id:n,identity:e}})}AccountSetPassword(e,t,n){var i=this.__id();return this.__execute_rr({id:i,responder:n,request:{method:"account/set-password",id:i,identity:e,password:t}})}AccountGetPaymentPlan(e,t){var n=this.__id();return this.__execute_rr({id:n,responder:t,request:{method:"account/get-payment-plan",id:n,identity:e}})}AccountLogin(e,t,n){var i=this.__id();return this.__execute_rr({id:i,responder:n,request:{method:"account/login",id:i,email:e,password:t}})}Probe(e,t){var n=this.__id();return this.__execute_rr({id:n,responder:t,request:{method:"probe",id:n,identity:e}})}AuthorityCreate(e,t){var n=this.__id();return this.__execute_rr({id:n,responder:t,request:{method:"authority/create",id:n,identity:e}})}AuthoritySet(e,t,n,i){var r=this.__id();return this.__execute_rr({id:r,responder:i,request:{method:"authority/set",id:r,identity:e,authority:t,"key-store":n}})}AuthorityGet(e,t,n){var i=this.__id();return this.__execute_rr({id:i,responder:n,request:{method:"authority/get",id:i,identity:e,authority:t}})}AuthorityList(e,t){var n=this.__id();return this.__execute_stream({id:n,responder:t,request:{method:"authority/list",id:n,identity:e}})}AuthorityDestroy(e,t,n){var i=this.__id();return this.__execute_rr({id:i,responder:n,request:{method:"authority/destroy",id:i,identity:e,authority:t}})}SpaceCreate(e,t,n,i){var r=this.__id();return this.__execute_rr({id:r,responder:i,request:{method:"space/create",id:r,identity:e,space:t,template:n}})}SpaceGenerateKey(e,t,n){var i=this.__id();return this.__execute_rr({id:i,responder:n,request:{method:"space/generate-key",id:i,identity:e,space:t}})}SpaceGet(e,t,n){var i=this.__id();return this.__execute_rr({id:i,responder:n,request:{method:"space/get",id:i,identity:e,space:t}})}SpaceSet(e,t,n,i){var r=this.__id();return this.__execute_rr({id:r,responder:i,request:{method:"space/set",id:r,identity:e,space:t,plan:n}})}SpaceRedeployKick(e,t,n){var i=this.__id();return this.__execute_rr({id:i,responder:n,request:{method:"space/redeploy-kick",id:i,identity:e,space:t}})}SpaceSetRxhtml(e,t,n,i){var r=this.__id();return this.__execute_rr({id:r,responder:i,request:{method:"space/set-rxhtml",id:r,identity:e,space:t,rxhtml:n}})}SpaceGetRxhtml(e,t,n){var i=this.__id();return this.__execute_rr({id:i,responder:n,request:{method:"space/get-rxhtml",id:i,identity:e,space:t}})}SpaceSetPolicy(e,t,n,i){var r=this.__id();return this.__execute_rr({id:r,responder:i,request:{method:"space/set-policy",id:r,identity:e,space:t,"access-policy":n}})}SpaceGetPolicy(e,t,n){var i=this.__id();return this.__execute_rr({id:i,responder:n,request:{method:"space/get-policy",id:i,identity:e,space:t}})}SpaceMetrics(e,t,n,i,r){var o=this.__id();return this.__execute_rr({id:o,responder:r,request:{method:"space/metrics",id:o,identity:e,space:t,prefix:n,"metric-query":i}})}SpaceDelete(e,t,n){var i=this.__id();return this.__execute_rr({id:i,responder:n,request:{method:"space/delete",id:i,identity:e,space:t}})}SpaceSetRole(e,t,n,i,r){var o=this.__id();return this.__execute_rr({id:o,responder:r,request:{method:"space/set-role",id:o,identity:e,space:t,email:n,role:i}})}SpaceListDevelopers(e,t,n){var i=this.__id();return this.__execute_stream({id:i,responder:n,request:{method:"space/list-developers",id:i,identity:e,space:t}})}SpaceReflect(e,t,n,i){var r=this.__id();return this.__execute_rr({id:r,responder:i,request:{method:"space/reflect",id:r,identity:e,space:t,key:n}})}SpaceList(e,t,n,i){var r=this.__id();return this.__execute_stream({id:r,responder:i,request:{method:"space/list",id:r,identity:e,marker:t,limit:n}})}DomainMap(e,t,n,i,r){var o=this.__id();return this.__execute_rr({id:o,responder:r,request:{method:"domain/map",id:o,identity:e,domain:t,space:n,certificate:i}})}DomainReflect(e,t,n){var i=this.__id();return this.__execute_rr({id:i,responder:n,request:{method:"domain/reflect",id:i,identity:e,domain:t}})}DomainMapDocument(e,t,n,i,r,o,a){var s=this.__id();return this.__execute_rr({id:s,responder:a,request:{method:"domain/map-document",id:s,identity:e,domain:t,space:n,key:i,route:r,certificate:o}})}DomainList(e,t){var n=this.__id();return this.__execute_stream({id:n,responder:t,request:{method:"domain/list",id:n,identity:e}})}DomainListBySpace(e,t,n){var i=this.__id();return this.__execute_stream({id:i,responder:n,request:{method:"domain/list-by-space",id:i,identity:e,space:t}})}DomainUnmap(e,t,n){var i=this.__id();return this.__execute_rr({id:i,responder:n,request:{method:"domain/unmap",id:i,identity:e,domain:t}})}DomainGet(e,t,n){var i=this.__id();return this.__execute_rr({id:i,responder:n,request:{method:"domain/get",id:i,identity:e,domain:t}})}DocumentAuthorize(e,t,n,i,r){var o=this.__id();return this.__execute_rr({id:o,responder:r,request:{method:"document/authorize",id:o,space:e,key:t,username:n,password:i}})}DocumentAuthorizeDomain(e,t,n,i){var r=this.__id();return this.__execute_rr({id:r,responder:i,request:{method:"document/authorize-domain",id:r,domain:e,username:t,password:n}})}DocumentAuthorizeWithReset(e,t,n,i,r,o){var a=this.__id();return this.__execute_rr({id:a,responder:o,request:{method:"document/authorize-with-reset",id:a,space:e,key:t,username:n,password:i,new_password:r}})}DocumentAuthorizeDomainWithReset(e,t,n,i,r){var o=this.__id();return this.__execute_rr({id:o,responder:r,request:{method:"document/authorize-domain-with-reset",id:o,domain:e,username:t,password:n,new_password:i}})}DocumentCreate(e,t,n,i,r,o){var a=this.__id();return this.__execute_rr({id:a,responder:o,request:{method:"document/create",id:a,identity:e,space:t,key:n,entropy:i,arg:r}})}DocumentDelete(e,t,n,i){var r=this.__id();return this.__execute_rr({id:r,responder:i,request:{method:"document/delete",id:r,identity:e,space:t,key:n}})}DocumentList(e,t,n,i,r){var o=this.__id();return this.__execute_stream({id:o,responder:r,request:{method:"document/list",id:o,identity:e,space:t,marker:n,limit:i}})}MessageDirectSend(e,t,n,i,r,o){var a=this.__id();return this.__execute_rr({id:a,responder:o,request:{method:"message/direct-send",id:a,identity:e,space:t,key:n,channel:i,message:r}})}MessageDirectSendOnce(e,t,n,i,r,o,a){var s=this.__id();return this.__execute_rr({id:s,responder:a,request:{method:"message/direct-send-once",id:s,identity:e,space:t,key:n,dedupe:i,channel:r,message:o}})}ConnectionCreate(e,t,n,i,r){var c=this,u=c.__id();return c.__execute_stream({id:u,responder:r,request:{method:"connection/create",id:u,identity:e,space:t,key:n,"viewer-state":i},send:function(e,t,n){var i=c.__id();c.__execute_rr({id:i,responder:n,request:{method:"connection/send",id:i,connection:u,channel:e,message:t}})},password:function(e,t,n,i){var r=c.__id();c.__execute_rr({id:r,responder:i,request:{method:"connection/password",id:r,connection:u,username:e,password:t,new_password:n}})},sendOnce:function(e,t,n,i){var r=c.__id();c.__execute_rr({id:r,responder:i,request:{method:"connection/send-once",id:r,connection:u,channel:e,dedupe:t,message:n}})},canAttach:function(e){var t=c.__id();c.__execute_rr({id:t,responder:e,request:{method:"connection/can-attach",id:t,connection:u}})},attach:function(e,t,n,i,r,o,a){var s=c.__id();c.__execute_rr({id:s,responder:a,request:{method:"connection/attach",id:s,connection:u,"asset-id":e,filename:t,"content-type":n,size:i,"digest-md5":r,"digest-sha384":o}})},update:function(e,t){var n=c.__id();c.__execute_rr({id:n,responder:t,request:{method:"connection/update",id:n,connection:u,"viewer-state":e}})},end:function(e){var t=c.__id();c.__execute_rr({id:t,responder:e,request:{method:"connection/end",id:t,connection:u}})}})}ConnectionCreateViaDomain(e,t,n,i){var c=this,u=c.__id();return c.__execute_stream({id:u,responder:i,request:{method:"connection/create-via-domain",id:u,identity:e,domain:t,"viewer-state":n},send:function(e,t,n){var i=c.__id();c.__execute_rr({id:i,responder:n,request:{method:"connection/send",id:i,connection:u,channel:e,message:t}})},password:function(e,t,n,i){var r=c.__id();c.__execute_rr({id:r,responder:i,request:{method:"connection/password",id:r,connection:u,username:e,password:t,new_password:n}})},sendOnce:function(e,t,n,i){var r=c.__id();c.__execute_rr({id:r,responder:i,request:{method:"connection/send-once",id:r,connection:u,channel:e,dedupe:t,message:n}})},canAttach:function(e){var t=c.__id();c.__execute_rr({id:t,responder:e,request:{method:"connection/can-attach",id:t,connection:u}})},attach:function(e,t,n,i,r,o,a){var s=c.__id();c.__execute_rr({id:s,responder:a,request:{method:"connection/attach",id:s,connection:u,"asset-id":e,filename:t,"content-type":n,size:i,"digest-md5":r,"digest-sha384":o}})},update:function(e,t){var n=c.__id();c.__execute_rr({id:n,responder:t,request:{method:"connection/update",id:n,connection:u,"viewer-state":e}})},end:function(e){var t=c.__id();c.__execute_rr({id:t,responder:e,request:{method:"connection/end",id:t,connection:u}})}})}DocumentsHashPassword(e,t){var n=this.__id();return this.__execute_rr({id:n,responder:t,request:{method:"documents/hash-password",id:n,password:e}})}BillingConnectionCreate(e,t){var c=this,u=c.__id();return c.__execute_stream({id:u,responder:t,request:{method:"billing-connection/create",id:u,identity:e},send:function(e,t,n){var i=c.__id();c.__execute_rr({id:i,responder:n,request:{method:"connection/send",id:i,connection:u,channel:e,message:t}})},password:function(e,t,n,i){var r=c.__id();c.__execute_rr({id:r,responder:i,request:{method:"connection/password",id:r,connection:u,username:e,password:t,new_password:n}})},sendOnce:function(e,t,n,i){var r=c.__id();c.__execute_rr({id:r,responder:i,request:{method:"connection/send-once",id:r,connection:u,channel:e,dedupe:t,message:n}})},canAttach:function(e){var t=c.__id();c.__execute_rr({id:t,responder:e,request:{method:"connection/can-attach",id:t,connection:u}})},attach:function(e,t,n,i,r,o,a){var s=c.__id();c.__execute_rr({id:s,responder:a,request:{method:"connection/attach",id:s,connection:u,"asset-id":e,filename:t,"content-type":n,size:i,"digest-md5":r,"digest-sha384":o}})},update:function(e,t){var n=c.__id();c.__execute_rr({id:n,responder:t,request:{method:"connection/update",id:n,connection:u,"viewer-state":e}})},end:function(e){var t=c.__id();c.__execute_rr({id:t,responder:e,request:{method:"connection/end",id:t,connection:u}})}})}ConfigureMakeOrGetAssetKey(e){var t=this.__id();return this.__execute_rr({id:t,responder:e,request:{method:"configure/make-or-get-asset-key",id:t}})}AttachmentStart(e,t,n,i,r,o){var a=this,s=a.__id();return a.__execute_stream({id:s,responder:o,request:{method:"attachment/start",id:s,identity:e,space:t,key:n,filename:i,"content-type":r},append:function(e,t,n){var i=a.__id();a.__execute_rr({id:i,responder:n,request:{method:"attachment/append",id:i,upload:s,"chunk-md5":e,"base64-bytes":t}})},finish:function(e){var t=a.__id();a.__execute_rr({id:t,responder:e,request:{method:"attachment/finish",id:t,upload:s}})}})}AttachmentStartByDomain(e,t,n,i,r){var o=this,a=o.__id();return o.__execute_stream({id:a,responder:r,request:{method:"attachment/start-by-domain",id:a,identity:e,domain:t,filename:n,"content-type":i},append:function(e,t,n){var i=o.__id();o.__execute_rr({id:i,responder:n,request:{method:"attachment/append",id:i,upload:a,"chunk-md5":e,"base64-bytes":t}})},finish:function(e){var t=o.__id();o.__execute_rr({id:t,responder:e,request:{method:"attachment/finish",id:t,upload:a}})}})}}var Adama={Production:"aws-us-east-2.adama-platform.com",Connection:WebSocketAdamaConnection},RxHTML=function(){function a(e){return e?e.startsWith("/")?B+e.substring(1):e:"#"}function d(e){var d;return e in T?T[e]:((d={name:e,ptr:null,tree:new AdamaTree,outstanding:{},decisions:{},choice_subs:{},resets:{},connection_events:{},sync_events:{},id:0,connection_state:!1,choices:{},bound:"",viewstate_sent:!0,viewstate_clone:"",has_filter:!1,synced:!1,filter:{},vsseq:0,debugger:function(e){},raw:C}).nuke=function(){this.connection_events={},this.sync_events={},this.choice_subs={}}.bind(d),Adama.Debugger&&(d.debugger=Adama.Debugger.register(d)),d.sync=function(){var e=this.connection_state&&this.viewstate_sent;if(this.synced!=e){this.synced=e;var t,n=[];for(t in d.sync_events)d.sync_events[t](e)||n.push(t);for(var i=0;i<n.length;i++)delete d.sync_events[n[i]]}}.bind(d),d.subscribe_sync=function(e){var t="-|"+this.id++;return(this.sync_events[t]=e)(this.synced),function(){delete this.sync_events[t]}.bind(this)},d.set_connected=function(e){if(this.connection_state!=e){this.connection_state=e;var t,n=[];for(t in d.connection_events)d.connection_events[t](e)||n.push(t);for(var i=0;i<n.length;i++)delete d.connection_events[n[i]];this.sync()}}.bind(d),d.connected=function(e){var t="-|"+this.id++;return(this.connection_events[t]=e)(this.connection_state),function(){delete this.connection_events[t]}.bind(this)}.bind(d),d.subscribe_any=function(e){var t="-|"+this.id++;return this.decisions[t]=e,function(){delete this.decisions[t]}.bind(this)}.bind(d),d.subscribe=function(e,t){var n=e+"|"+this.id++;return this.decisions[n]=t,function(){delete this.decisions[n]}.bind(this)}.bind(d),d.subscribe_reset=function(e){var t="reset|"+this.id++;return this.resets[t]=e,function(){delete this.resets[t]}.bind(this)}.bind(d),d.subscribe_choice=function(e,t){var n=e+"|"+this.id++;return this.choice_subs[n]=t,function(){delete this.choice_subs[n]}.bind(this)}.bind(d),d.onchoices=function(e,t){var n,i=[];for(n in d.choice_subs)!n.startsWith(e+"|")||d.choice_subs[n](t)||i.push(n);for(var r=0;r<i.length;r++)delete d.choice_subs[i[r]]},d.ondecide=function(e){var t,n=[];for(t in d.resets)(0,d.resets[t])()||n.push(t);for(var i=0;i<n.length;i++)delete d.resets[n[i]];for(r in d.outstanding)d.outstanding[r]={options:[]};for(var r,o=e.length,i=0;i<o;i++){var a=e[i];d.outstanding[a.channel]=a}for(r in d.outstanding){var s,c=d.outstanding[r],u=[];for(s in d.decisions)!s.startsWith(r+"|")&&!s.startsWith("-|")||d.decisions[s](c,r)||u.push(s);for(i=0;i<u.length;i++)delete d.decisions[u[i]]}},T[e]=d)}function l(e,t,n){e=q.pI(e,t),"@e"in(t=e[e.current]).delta?t.delta["@e"].push(n):t.delta["@e"]=[n]}function L(e){return{tree:new AdamaTree,delta:{},parent:null,path:null,where:e}}function f(e){return"password"in e&&delete e.password,"one_time_password"in e&&delete e.one_time_password,e}function u(e){if(null==e)return null;var t=null,n={};return null!=(t=null!=e.parent?u(e.parent):t)&&(t.delta[e.path]=n),{tree:e.tree,parent:t,delta:n,path:e.path}}function s(e,t){var n;return null!=e.parent?((n={})[e.path]=t,s(e.parent,n)):t}function i(e){for(var t=e;null!=t.parent;)t=t.parent;return t}function h(e){for(var t=e.lastChild;t;)e.removeChild(t),t=e.lastChild}function _(e,t){var n={inflight:!1,timeout:null,inflight:!1};return function(){n.inflight||(n.inflight=!0,n.timeout=window.setTimeout(function(){n.inflight=!1,n.timeout=null,t()},e))}}function p(){return{__data:function(){},__view:function(){}}}function v(e){e.__data=function(){},e.__view=function(){}}function m(e){e.__data(),e.__view()}function y(e,t){var n;t.__data=function(){},t.__view=function(){},null!=e.data&&(n=i(e.data).delta,r(n)||(t.__data=e.data.tree.subscribe(n))),null!=e.view&&(n=i(e.view).delta,r(n)||(t.__view=e.view.tree.subscribe(n)))}function g(e){var t={service:e.service,data:u(e.data),view:u(e.view),current:e.current};return null!=t.data&&(t.data.connection=e.data.connection),t}function w(e,t,n,i){if(t in e.data.connection.outstanding)for(var r=e.data.connection.outstanding[t].options,o=0;o<r.length;o++){var a=r[o];if(n in a&&a[n]==i)return a}return null}function c(e){e.dispatchEvent(new Event("success"))}function b(e,t){var n=new Event("failure");n.message=t,console.log("FAILURE:"+t),e.dispatchEvent(n)}function M(e,t){var n,e=e.data.connection.choices,i=(t in e||(e[t]={}),e[t]),r=[];for(n in i)r.push(i[n]);return r}function F(e){for(var t=e;null!=t;){if("FORM"==t.tagName.toUpperCase())return t;t=t.parentElement}return null}function o(e,t){if("object"!=typeof e||"object"!=typeof t)return e;var n,i={};for(n in e)n in t?i[n]=o(e[n],t[n]):i[n]=e[n];for(n in t)n in e||(i[n]=t[n]);return i}function x(e,t){return 0<e&&0<t?Math.min(e,t):0<e?e:t}function k(e,t,n){var i="TEXTAREA"==e.tagName.toUpperCase()||"SELECT"==e.tagName.toUpperCase(),r="INPUT"==e.tagName.toUpperCase(),o="FIELDSET"==e.tagName.toUpperCase(),a="name"in e,s=t,c=function(e){};if(a&&(i||r||o)){var u="";if(""==(u=e.name))return;for(var d=x(u.indexOf("."),u.indexOf("/"));0<d;){var f=u.substring(0,d);f in s||(s[f]={}),s=s[f],u=u.substring(d+1),d=x(u.indexOf("."),u.indexOf("/"))}c=u.endsWith("+")?(u=u.substring(0,u.length-1),function(e){u in s?s[u].push(e):s[u]=[e]}):function(e){s[u]=e}}if(i)c(e.value);else if(o){var l={};if("children"in e)for(var h=e.children.length,_=0;_<h;_++){var p=e.children[_];k(p,l,n)}c(l)}else if(r){a="type"in e?e.type.toUpperCase():"TEXT";"SUBMIT"==a||"RESET"==a||"PASSWORD"==a&&!n||("CHECKBOX"==a?c(!!e.checked):"RADIO"==a&&!e.checked||c(e.value))}else if("children"in e)for(h=e.children.length,_=0;_<h;_++){p=e.children[_];k(p,t,n)}}function S(e,t,n,i){if(t<e.length){if("number"in n){var r=n.number,o=parseFloat(e[t]);if(!isNaN(o))for(var a in r){if(i[a]=o,null!==(s=S(e,t+1,r[a],i)))return s;delete i[a]}}if("text"in n){r=n.text,o=e[t];for(a in r){if(i[a]=o,null!==(s=S(e,t+1,r[a],i)))return s;delete i[a]}}var s;if("fixed"in n)for(a in r=n.fixed)if(a==e[t])if(null!==(s=S(e,t+1,r[a],i)))return s}else if("@"in n)return n["@"]}function D(o,a,i,s){return s.unexpected_errors=0,s.backoff=1,{next:function(e){var t;if(o.debugger(e),o.set_connected(!0),s.unexpected_errors=0,s.backoff=1,"data"in e.delta&&o.tree.update(e.delta.data),"outstanding"in e.delta&&o.ondecide(e.delta.outstanding),"viewstate"in e.delta&&a.view.tree.update(e.delta.viewstate),"log"in e.delta&&console.log(e.delta.log),"viewport"in e.delta&&"message"in e.delta&&((t=e.delta.viewport)in o.handlers&&o.handlers[t](e.delta.message,o)),"view-state-filter"in e.delta){for(var n={},i=e.delta["view-state-filter"],r=0;r<i.length;r++)n[i[r]]=!0;o.filter=n,o.has_filter=!0}"goto"in e.delta&&q.goto(e.delta.goto)},complete:function(){o.set_connected(!1),o.ptr=null},failure:function(e){var t,n;o.set_connected(!1),o.ptr=null,403403==e||403500==e||184333==e?i():(t=999==e,(n=s.unexpected_errors<10)&&s.unexpected_errors++,t||n?(s.backoff=Math.ceil(Math.min(s.backoff+Math.random()*s.backoff+(n?100:1),1e3)),console.log("connect-failure|retrying... ("+s.backoff+"); reason="+e+(n?" [blind]":"")),window.setTimeout(function(){s.go()},s.backoff)):console.log("gave up connection;"+o.label+"; reason="+e))}}}function A(e,t,r,o){function n(){var e,t=f(o.view.tree.copy());if(r.has_filter){var n,i={};for(n in t)r.filter[n]&&(i[n]=t[n]);t=i}JSON.stringify(t)!=r.viewstate_clone&&(r.viewstate_sent=!1,r.vsseq++,r.sync(),e=function(){r.vsseq==this.bound&&(r.viewstate_sent=!0,r.sync())}.bind({bound:r.vsseq}),r.viewstate_clone=JSON.stringify(t),r.ptr.update(t,{success:e,failure:e}))}function i(e){t.view=o.view.tree.subscribe(function(){null!=r.ptr&&n()}),e&&n()}return null!=r.ptr&&r.bound==e?(i(!0),!1):(null!=r.ptr&&(r.ptr.end({success:function(){},failure:function(){}}),r.ptr=null),i)}function W(e){if("INPUT"==e.tagName.toUpperCase())"email"==e.type&&"email"==e.name&&(e.value=localStorage.getItem("email_remember"));else if("children"in e)for(var t=e.children.length,n=0;n<t;n++)W(e.children[n])}function j(r,e,o,a,s){a.__=function(){},r.onsubmit=function(e){e.preventDefault();function t(){var e=s(a),t=new XMLHttpRequest;t.onreadystatechange=function(){var e;4==this.readyState&&(200==this.status?"text/error"==(e=this.getResponseHeader("Content-Type"))?b(r,this.responseText):("application/json"==e&&"identity"in(e=JSON.parse(this.responseText))&&(U[o]=e.identity,localStorage.setItem("identity_"+o,e.identity)),q.goto(a.rx_forward),c(r)):b(r,"Failed to communicate to server"))},t.open("PUT",e,!0),t.withCredentials=!0,t.send(JSON.stringify(n))}var n=N(r,!1),i=K(r);null!==i?C.DocumentsHashPassword(i[1],{success:function(e){n[i[0]]=e.passwordHash,t()},failed:function(){b(r,"Failed to hash password")}}):t()}}function G(e,t){var n="SELECT"==(n=e.tagName.toUpperCase())||"INPUT"==n||"HIDDEN"==n;if("name"in e&&n){for(var i=e.name,r=t,o=x(i.indexOf("."),i.indexOf("/"));0<o;){var a=i.substring(0,o),i=i.substring(o+1);if(!(a in r))return;r=r[a],o=x(i.indexOf("."),i.indexOf("/"))}i in r&&("CHECKBOX"==(n=e.type.toUpperCase())?e.checked="true"==r[i]||!0===r[i]:"RADIO"==n?r[i]==e.value&&(e.checked=!0):e.value=r[i])}if("children"in e)for(var s=e.children.length,c=0;c<s;c++){var u=e.children[c];G(u,t)}}var e,t,q={},z={},V={},C=new Adama.Connection(Adama.Production),T={},I=document.createElement("div"),B=(C.onstatuschange=function(e){function n(e){return'<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="'+e+'" style="width:16px; height:16px"><path stroke-linecap="round" stroke-linejoin="round" d="M8.288 15.038a5.25 5.25 0 017.424 0M5.106 11.856c3.807-3.808 9.98-3.808 13.788 0M1.924 8.674c5.565-5.565 14.587-5.565 20.152 0M12.53 18.22l-.53.53-.53-.53a.75.75 0 011.06 0z" /></svg>\n'}e?C.onping=function(e,t){I.title="connected; latency="+t+"ms",I.innerHTML=n(100<=t?"orange":"green")}:(I.title="disconnected",I.innerHTML=n("red"),C.onping=function(e,t){})},I.style="position:fixed; bottom:0px; right:0px",Adama.Debugger&&(I.onclick=Adama.Debugger.toggle),C.start(),"/"),H=function(e){return e},r=(window.location.hostname.endsWith(".adama-platform.com")&&!window.location.hostname.endsWith("ide.adama-platform.com")&&(e=window.location.pathname.split("/"),B=[e[0],e[1],e[2],""].join("/"),t=e[0].length+e[1].length+e[2].length+2,H=function(e){return e.substring(t)}),q.getConnectionByName=d,q.make=function(){return new AdamaTree},q.subscribe=l,q.fresh=L,q.makeDeltaCopy=u,q.pathTo=s,q.rootOf=i,q.nuke=h,q.debounce=_,function(e){if("function"==typeof e)return!1;if(Array.isArray(e)){for(var t=0;t<e.length;t++)if(!r(e[t]))return!1}else if("object"==typeof e)for(var n in e)if(!r(e[n]))return!1;return!0}),E=(q.pV=function(e){return{service:e.service,data:e.data,view:e.view,current:"view"}},q.newStateViewOf=q.pV,q.pD=function(e){return{service:e.service,data:e.data,view:e.view,current:"data"}},q.newStateDataOf=q.pD,q.pR=function(e){for(var t={service:e.service,data:e.data,view:e.view,current:e.current},n=t[e.current];null!=n;)n=(t[e.current]=n).parent;return t},q.newStateRootOf=q.pR,q.pU=function(e){var t={service:e.service,data:e.data,view:e.view,current:e.current},n=t[e.current];return null!=n.parent&&(t[e.current]=n),t},q.newStateParentOf=q.pU,q.pI=function(e,t){var n=e[e.current],i=(t in n.delta||(n.delta[t]={}),{service:e.service,data:e.data,view:e.view,current:e.current});return i[e.current]={tree:n.tree,delta:n.delta[t],parent:n,path:t},"data"==i.current&&(i.data.connection=n.connection),i},q.newStateDiveInto=q.pI,q.pEV=function(e,t){return t in e.view.delta||(e.view.delta[t]={}),{service:e.service,data:e.data,view:{tree:e.view.tree,delta:e.view.delta[t],parent:e.view,path:t},current:e.current}},q.newStateCreateViewChild=q.pEV,q.pIE=function(e,t,n){e=q.pI(e,t);return n?q.pEV(e,t):e},q.Y=function(e,t,n,i){l(e,n,function(e){t[n]=e,i()})},q.Y2=function(e,n,i,r,o){l(e,r,function(e){var t=n._[i];return t[r]=e,o(t),!0})},q.RX=function(e){for(var t={_:{}},n=0;n<e.length;n++)t._[e[n]]={};return t.__=function(){},t},q.YS=function(e,t,n){l(e,n,function(e){return t[n]=e,!0})},q.T=function(e){return document.createTextNode(e)},q.B=function(e){return!0===e||"true"==e},q.VW=function(n,i,r){r.__=_(50,function(){var e={},t=r.value,t=(e[i]="function"==typeof t?t():t,s(n.view,e));n[n.current].tree.update(t)})},q.L=function(e,t){var n=document.createTextNode("");return l(e,t,function(e){n.nodeValue=e}),n},q.LT=function(e,t,n){var i=document.createTextNode("");return l(e,t,function(e){null!=e&&(i.nodeValue=n(e))}),i},q.LTdT=function(e,t,n,i){var r=document.createTextNode(""),o={},a=(o.freq=i,o.value="",o.update=function(){r.nodeValue=n(this.value)}.bind(o),function(e){null!=e&&(this.value=e,this.update())}.bind(o));return o.refresh=function(){this.update(),document.body.contains(r)&&window.setTimeout(this.refresh,this.freq)}.bind(o),window.setTimeout(o.refresh,i),l(e,t,a),r},q.E=function(e,t){return null==t?document.createElement(e):((e=document.createElementNS(t,e)).setAttribute("xmlns",t),e)},q.P=function(i,r,e,o,a){var s=p();e.__=function(){var n;"name"in e&&this.name!=e.name&&(n=d(e.name),this.name=e.name,n.connected(function(e){h(i),m(s);var t={service:r.service,data:{connection:n,tree:n.tree,delta:{},parent:null,path:null},view:u(r.view),current:"data"};return(e?o:a)(i,t),y(t,s),!0}))}.bind({name:""})},q.TP=function(e,t){z[e]=t},q.UT=function(e,t,n,i){(0,z[n])(e,t,i)},q.SW=function(n,i,e,r){var t={prior:null},t=(v(t),function(e){var t;e!=this.prior&&(this.prior=e,m(this),h(n),t=g(i),r(n,t,""+e),y(t,this))}.bind(t));l(i,e,t)},q.IT=function(r,e,t,o,a){var s=q.pIE(e,t,o),c={},u={};l(e,t,{"+":function(e){var t=g(q.pIE(s,e,o)),n=p(),i=a(t),e=(c[e]=i,u[e]=n,r.append(i),t.data.delta);return t.data.delta={},y(t,n),e},"-":function(e){e in c&&(r.removeChild(c[e]),delete c[e]),e in u&&(m(u[e]),delete u[e])},"~":function(e){if(h(r),null==e){for(var t in u)m(u[t]),delete u[t];for(var t in c)delete c[t]}else for(var n=0;n<e.length;n++)r.append(c[e[n]])}})},q.RP=function(o,e,t,a,s){var c=q.pIE(e,t,a),n=function(e){var t=0;try{t="number"==typeof e?e:parseInt(e)}catch(e){}for(;this.at<t-1;){this.at++,this.track++;var n=g(q.pIE(c,this.track+"",a)),i=p(),r=s(n);this.items[this.at]={unsub:i,dom:r},o.append(r),y(n,i)}for(;this.at>=t&&0<=this.at;)m(this.items[this.at].unsub),o.removeChild(this.items[this.at].dom),this.items[this.at]=null,delete this.items[this.at],this.at--}.bind({items:[],at:-1,track:0});l(e,t,n)},{}),O=(q.PRCUAC=function(e,t){E[e]=t},q.exCC=function(e,t,n,i){O(n,e,t,function(){i in E&&E[i](n,e)})},q.fire_success=c,q.fire_failure=b,q.aCC=function(t,n,i){function r(e){null==r?c(t):b(t,e)}t.onsubmit=function(e){i in E?(e.preventDefault(),e=N(t,!1),E[i](e,n,r,q),c(t)):b(t,"Failed to find '"+i+"'")}},q.exFIN=function(e,t,n,i){O(n,e,t,function(){function t(){delete n.data.connection.choices[i],n.data.connection.onchoices(i,{})}var e=M(n,i);n.data.connection.ptr.send(i,e,{failure:function(e){t(),console.log("failed:"+e)},success:function(e){t(),console.log("Success|"+e.seq)}})})},q.FIN=function(n,i,r,o,e,a,s){var c={owner:n,shown:!1};v(c);c.update=function(){var e,t=i.data.connection.outstanding[r];t&&(e=M(i,r),e=!("min"in t&&"max"in t)||t.min<=e.length&&e.length<=t.max,c.eval!=e&&(c.eval=e,t=c.eval,m(c),h(n),e=g(i),(t===o?a:s)(n,e),y(e,c)))},i.data.connection.subscribe_choice(r,function(){return c.update(),!0})},function(e,t,n,i){var r;"load"==n?window.setTimeout(i,1):n.startsWith("delay:")?(r=parseInt(n.substring(6)),window.setTimeout(function(){document.body.contains(t)&&i()},r)):t.addEventListener(n,i)}),N=(q.bS=function(e,t,n,i){var r,o;return"function"==typeof i?{run:function(){},merge:function(){var e={};return e[n]=i(),s(t.view,e)}}:((r={})[n]=i,o=s(t.view,r),{run:function(){},merge:function(){return o}})},q.MD=o,q.onB=function(e,t,i,r){O(i,e,t,function(){for(var e={},t=0;t<r.length;t++)var n=r[t],n=(n.run(),n.merge()),e=o(e,n);i[i.current].tree.update(e)})},q.exCH=function(e,t,i,n,r,o){var a={value:null};O(i,e,t,function(){var e,t,n=w(i,r,o,a.value);null!=n&&(e=i.data.connection.choices,r in e||(e[r]={}),e=e[r],(t=n[o])in e?delete e[t]:e[t]=n,i.data.connection.onchoices(r,e))}),l(i,n,function(e){a.value=e})},q.exD=function(e,t,n,i,r,o){var a={value:null};O(n,e,t,function(){var e=w(n,r,o,a.value);if(null!=e){let t=performance.now();n.data.connection.ptr.send(r,e,{failure:function(e){},success:function(e){console.log("Success|"+e.seq+";latency="+(performance.now()-t))}})}}),l(n,i,function(e){a.value=e})},q.onFR=function(e,t,n,i){O(e,t,n,function(){e.data.connection.ptr.send(i,{},{success:function(){console.log("SENT '"+i+"'")},failure:function(e){console.log("FAILED TO FIRE '"+i+"' DUE:"+e)}})})},q.onFORCE_AUTH=function(e,t,n,i){O(null,e,t,function(){U[n]=i,localStorage.setItem("identity_"+n,i)})},q.onS=function(e,t,n,i,r){O(n,e,t,function(){var e={},e=(e[i]="function"==typeof r?r():r,s(n.view,e));n[n.current].tree.update(e)})},q.onTM=function(e,t,n,i,r,o){O(n,e,t,function(e){var t={},e=(t[i]={x:e.clientX+window.scrollX+r,y:e.clientY+window.scrollY+o},s(n.view,t));n[n.current].tree.update(e)})},q.onTE=function(e,t,n,i){O(n,e,t,function(e){var t={},e=(t[i]=e.message,s(n.view,t));n[n.current].tree.update(e)})},q.oRST=function(n,e,t){O(t,n,e,function(e){var t=F(n);null!=t&&t.reset()})},q.oSBMT=function(n,e,t){O(t,n,e,function(e){var t=F(n);null!=t&&t.onsubmit(new SubmitEvent("submit"))})},q.onGO=function(e,t,n,i){O(n,e,t,function(){var e="function"==typeof i?i():i;q.goto(e)})},q.onT=function(e,t,n,i){var r={value:!1};O(n,e,t,function(){var e={},e=(e[i]=!r.value,s(n.view,e));n[n.current].tree.update(e)}),l(n,i,function(e){r.value=1==e})},q.onOT=function(e,t,n,i,r){var o={value:""};O(n,e,t,function(){var e={},e=(e[i]=function(e,t){for(var n=e.split(","),i="",r=[""],o=0;o<n.length;o++)""!=n[o]&&(t==n[o]?i="-":"-"+t==n[o]?i="":r.push(n[o]));return r[0]=i+t,r.join(",")}(o.value,r),s(n.view,e));n[n.current].tree.update(e)}),l(n,i,function(e){o.value=e})},q.onD=function(e,t,n,i,r){var o={value:0};O(n,e,t,function(){var e={},e=(e[i]=o.value+r,s(n.view,e));n[n.current].tree.update(e)}),l(n,i,function(e){"number"==typeof e?o.value=e:(e=parseFloat(e),isNaN(e)||(o.value=e))})},q.CSEN=function(n,i,e,r,t,o,a,s,c,u){var d={value:"",owner:n,shown:!1,eval:null};v(d);d.update=function(){var e,t;i.data.connection.outstanding[r]&&(e=i.data.connection.choices,r in e||(e[r]={}),e=e[r],e=d.value in e,d.eval!=e&&(d.eval=e,e=d.eval,m(d),h(n),t=g(i),(e===a?c:u)(n,t),y(t,d)))},i.data.connection.subscribe_choice(r,function(){return d.update(),!0}),l(e,o,function(e){d.value=e,d.update()})},q.DE=function(n,i,e,r,o,t,a,s,c,u){var d={value:"",owner:n,shown:!1,eval:null};v(d);d.update=function(){var e,t=null!=w(i,r,o,d.value);d.eval!=t&&(d.eval=t,t=d.eval,m(d),h(n),e=g(i),(t===a?c:u)(n,e),y(e,d))},i.data.connection.subscribe(r,function(){return d.update(),!0}),l(e,t,function(e){d.value=e,d.update()})},q.IF=function(e,t,n,i,r,o,a){q.IFx(e,t,t,n,i,r,o,a)},q.IFx=function(i,r,o,a,s,c,u,d){var f=p(),e=function(e){var t,n=!!e===s;this.shown!=n&&(this.shown=n,h(i),m(f),t=null,"object"==typeof e?(t=g(o),t=q.pI(t,a),(t=c?q.pEV(t,a):t).current="data"):t=g(r),(n?u:d)(i,t),y(t,f))}.bind({shown:"no"});l(o,a,e)},q.aCP=function(n,i,r){n.onsubmit=function(e){e.preventDefault();var e=N(n,!1),t=("."!=r&&""!=r&&((t={})[r]=e,e=t),s(i.view,e));i.view.tree.update(t),c(n)}},q.SY=function(n,i,r,e){function t(e){(t={})[r]=n.value;var t=s(i.view,t);i.view.tree.update(t)}var o="type"in n?n.type.toUpperCase():"text";"CHECKBOX"==o?n.onchange=_(e,function(e){t(n.checked)}):"RADIO"==o?n.onchange=_(e,function(e){n.checked&&t(n.value)}):(n.onchange=_(e,function(e){t(n.value)}),n.onkeyup=n.onchange,window.setTimeout(function(){t(n.value)},1))},q.BuildFormObject=function(e){var t={};return k(e,t,!1),t},function(e,t){var n={};return k(e,n,t),n}),K=function(e){if("INPUT"==e.tagName.toUpperCase()&&"PASSWORD"==e.type.toUpperCase())return[e.name,e.value];if("children"in e)for(var t=e.children.length,n=0;n<t;n++){var i=e.children[n],i=K(i);if(null!==i)return i}return null},R={},P={},U=(q.PRWP=function(e,t){if(R[e]=t,e in P)for(var n=P[e],i=0;i<n.length;i++)n[i]()},q.WP=function(e,t,n,i,r){var o;n in R?R[n](e,t,i,r,q):(o=function(){R[n](e,t,i,r,q)},n in P?P[n].push(o):P[n]=[o])},q.PG=function(e,t){for(var n=V,i=0;i<e.length;i++){var r=e[i];r in n||(n[r]={}),n=n[r]}n["@"]=t},q.goto=function(e){window.setTimeout(function(){e.startsWith("/")?q.run(document.body,e,!0):window.location.href=a(e)},10)},q.init=function(){q.run(document.body,H(window.location.pathname+window.location.hash),!1),window.onpopstate=function(){q.run(document.body,H(window.location.pathname+window.location.hash),!1)}},q.run=function(e,t,n){for(var i=t;i.endsWith("/")&&"/"!=i;)i=i.substring(0,i.length-1);for(conKey in T)T[conKey].tree.nuke(),T[conKey].nuke();var t=(i.startsWith("/")?i.substring(1):i).split("/"),r={};try{r.viewer_timezone=Intl.DateTimeFormat().resolvedOptions().timeZone,r.viewer_language=navigator.language}catch(e){}var o,t=S(t,0,V,r);h(e),null!=t?((o={service:C,data:null,view:L(e),current:"view"}).view.init=r,t(e,o),o.view.tree.subscribe(o.view.delta),o.view.tree.update(r),n&&window.history.pushState({},"",a(i))):"/404"!=i&&q.run(e,"/404"),e.appendChild(I)},{}),X=(q.SIGNOUT=function(){U={},localStorage.removeItem("identity_default");var e,t=[];for(e in T){var n=T[e];null!=n.ptr&&n.ptr.end({success:function(){},failure:function(){}}),t.push(e)}for(var i=0;i<t.length;i++)delete T[t[i]];q.goto("/")},q.GOOGLE_SIGN_ON=function(e){C.InitConvertGoogleUser(e,{success:function(e){U.default=e.identity,localStorage.setItem("identity_default",e.identity),q.goto("/")},failure:function(e){console.log("Google failure: "+e)}})},q.aRDp=function(e,t){return function(){return t(e.view.init)}},q.aRDz=function(e){return function(){return e}},q.ID=function(e,t){!0===e&&(e="default");var n=null,i=function(){},r=localStorage.getItem("identity_"+e);if(r&&(U[e]=r),e.startsWith("direct:"))n=e.substring(7);else{if(!(e in U))return window.setTimeout(function(){q.goto(t())},10),{abort:!0};n=U[e],i=function(){delete U[e],localStorage.removeItem("identity_"+e),q.goto(t())}}return{abort:!1,cleanup:i,identity:n}},q.FIDCL=function(t,n){return{success:function(e){t.success(e)},next:function(e){t.next(e)},complete:function(){t.complete()},failure:function(e){t.failure(e),403403!=e&&403500!=e&&184333!=e||n.cleanup()}}},{}),n=(q.PRCUDA=function(e,t){X[e]=t},q.CUDA=function(n,i,r,o,a,s){var c=p();o.__=_(10,function(){m(c),h(n);var e=!1,t=(r in X&&("function"==typeof(t=X[r])&&(e=t(o,i,a,q))),e=e||new AdamaTree,{service:i.service,data:{connection:i.connection,tree:e,delta:{},parent:null,path:null},view:u(i.view),current:"data"});s(t),y(t,c)})},q.ST=function(e){document.title=e.value,e.__=_(1,function(){document.title=e.value})},q.VSy=function(n,i,r,o){var a=p();i.data.connection.subscribe_sync(function(e){h(n),m(a);var t=g(i);return(e?r:o)(n,t),y(t,a),!0})},q.BCONNECT=function(a,s){var c={view:function(){}};s.__=_(5,function(){var e,t,n,i,r,o;"name"in s&&((e=q.ID(s.identity,function(){return s.redirect})).abort||(t=d(s.name),r=":billing:"+e.identity,!1!==(n=A(r,c,t,a))&&(t.bound=r,i=e.identity,r=e.cleanup,c.view(),t.identity=i,t.handlers={},t.viewstate_sent=!0,t.label="Billing [ "+s.name+"]",t.via_billing=!0,t.via_domain=!1,(o={}).responder=D(t,a,r,o),o.go=function(){t.viewstate_clone="{}",t.ptr=C.BillingConnectionCreate(i,o.responder)},o.go(),t.tree.update({}),n(!1))))})},q.domain=location.hostname,q.host=location.host,q.protocol=location.protocol,q.mobileInit=function(e){q.domain=e,q.host=e,q.protocol="https"},q.DCONNECT=function(s,c){var u={view:function(){}};c.__=_(5,function(){var e,t,n,i,r,o,a;"name"in c&&((e=q.ID(c.identity,function(){return c.redirect})).abort||(t=d(c.name),o=(n=q.domain)+e.identity,!1!==(i=A(o,u,t,s))&&(t.bound=o,r=e.identity,o=e.cleanup,u.view(),t.identity=r,t.handlers={},t.viewstate_sent=!0,t.label="Domain:"+n+" [ "+c.name+"]",t.via_domain=!0,t.via_billing=!1,t.domain=n,(a={}).responder=D(t,s,o,a),a.go=function(){t.viewstate_clone="{}",t.ptr=C.ConnectionCreateViaDomain(r,n,f(s.view.tree.copy()),a.responder)},a.go(),t.tree.update({}),i(!1))))})},q.CONNECT=function(a,s){var c={view:function(){}};s.__=_(5,function(){var e,t,n,i,r,o;"key"in s&&"space"in s&&"name"in s&&((e=q.ID(s.identity,function(){return s.redirect})).abort||(t=d(s.name),r=s.space+"/"+s.key+"/"+e.identity,!1!==(n=A(r,c,t,a))&&(t.bound=r,i=e.identity,r=e.cleanup,c.view(),t.space=s.space,t.key=s.key,t.identity=i,t.handlers={},t.viewstate_sent=!0,t.label=t.space+"/"+t.key+" [ "+s.name+"]",t.via_domain=!1,t.via_billing=!1,(o={}).responder=D(t,a,r,o),o.go=function(){t.viewstate_clone="{}",t.ptr=C.ConnectionCreate(i,s.space,s.key,f(a.view.tree.copy()),o.responder)},o.go(),t.tree.update({}),n(!1))))})},q.INTERNAL=function(e){return{service:e.service,data:{connection:null,tree:new AdamaTree,delta:{},parent:null,path:null},view:u(e.view),current:"data"}},q.aUP=function(e,t,n,i){var r,n=q.ID(n,function(){return i.rx_forward});n.abort||(e.action="https://aws-us-east-2.adama-platform.com/~upload",e.method="post",e.enctype="multipart/form-data",(r=document.createElement("input")).type="hidden",r.name="identity",r.value=n.identity,e.appendChild(r),(n=document.createElement("iframe")).name="UPLOAD_"+Math.random(),n.width="1",n.height="1",e.appendChild(n),e.target=n.name)},q.aDUP=function(e,t,n,i){var r,n=q.ID(n,function(){return i.rx_forward});n.abort||(e.action="https://aws-us-east-2.adama-platform.com/~upload",e.method="post",e.enctype="multipart/form-data",(r=document.createElement("input")).type="hidden",r.name="identity",r.value=n.identity,e.appendChild(r),(n=document.createElement("input")).type="hidden",n.name="domain",n.value=q.domain,e.appendChild(n),(r=document.createElement("iframe")).name="UPLOAD_"+Math.random(),r.width="1",r.height="1",e.appendChild(r),e.target=r.name)},q.adDSO=function(t,e,n,i){i.__=function(){},t.onsubmit=function(e){e.preventDefault();e=N(t,!0);C.DocumentAuthorizeDomain(q.domain,e.username,e.password,{success:function(e){U[n]=e.identity,localStorage.setItem("identity_"+n,e.identity),q.goto(i.rx_forward),c(t)},failure:function(e){b(t,"Failed signing into document:"+e)}})}},q.aDSO=function(t,e,n,i){i.__=function(){},t.onsubmit=function(e){e.preventDefault();e=N(t,!0);C.DocumentAuthorize(e.space,e.key,e.username,e.password,{success:function(e){U[n]=e.identity,localStorage.setItem("identity_"+n,e.identity),q.goto(i.rx_forward),c(t)},failure:function(e){b(t,"Failed signing into document:"+e)}})}},q.adDSOr=function(t,e,n,i){i.__=function(){},t.onsubmit=function(e){e.preventDefault();e=N(t,!0);C.DocumentAuthorizeDomainWithReset(q.domain,e.username,e.password,e.new_password,{success:function(e){U[n]=e.identity,localStorage.setItem("identity_"+n,e.identity),q.goto(i.rx_forward),c(t)},failure:function(e){b(t,"Failed signing into document:"+e)}})}},q.aDSOr=function(t,e,n,i){i.__=function(){},t.onsubmit=function(e){e.preventDefault();e=N(t,!0);C.DocumentAuthorizeWithReset(e.space,e.key,e.username,e.password,e.new_password,{success:function(e){U[n]=e.identity,localStorage.setItem("identity_"+n,e.identity),q.goto(i.rx_forward),c(t)},failure:function(e){b(t,"Failed signing into document:"+e)}})}},{}),J=(n["principal.agent"]=function(e){return e.agent},n["principal.authority"]=function(e){return e.authority},n.trim=function(e){return(""+e).trim()},n.upper=function(e){return(""+e).toUpperCase()},n.lower=function(e){return(""+e).toLowerCase()},n.is_empty_str=function(e){return""==e},n.is_not_empty_str=function(e){return""!=e},n.jsonify=function(e){return JSON.stringify(e)},n.time_now=function(e){return Date.now()+""},n.vulgar_fraction=function(e){var t=0;if("number"==typeof e)t=e;else try{t=parseFloat(e)}catch(e){}var e=Math.floor(t),t=t-e,n="";return t<=.0625||(t<=.1875?n="⅛":t<=.3125?n="¼":t<=.4375?n="⅜":t<=.5625?n="½":t<=.6875?n="⅝":t<=.8125?n="¾":t<=.9375&&(n="⅞")),e+n},n.time_ago=function(e){if("string"!=typeof e)return e;var t=e,n=t.indexOf("["),n=(0<=n&&(t=t.substring(0,n)),Date.parse(t));if(Number.isNaN(n))return e;t=(Date.now()-n)/1e3;if(t<60)return Math.floor(t)+" seconds ago";if((t/=60)<60)return Math.floor(t)+" minutes ago";e=new Date(n),t=new Date;return e.toLocaleDateString()!=t.toLocaleDateString()?e.toLocaleDateString()+" "+e.toLocaleTimeString():e.toLocaleTimeString()},q.RTR=function(e,t){n[e]=t},q.registerTransform=q.RTR,q.TR=function(e){return e in n?n[e]:function(e){return e}},{});q.RV=function(e,t){J[e]=t},q.registerValidator=q.RV,q.adDPUT=function(e,t,n,i){j(e,0,n,i,function(e){return q.protocol+"//"+q.host+"/"+e.path})},q.aDPUT=function(e,t,n,i){j(e,0,n,i,function(e){return"https://"+C.host+"/"+e.space+"/"+e.key+"/"+e.path})},q.aSO=function(t,e,n,i){i.__=function(){},window.setTimeout(function(){W(t)},1),t.onsubmit=function(e){e.preventDefault();e=N(t,!0);e.remember?localStorage.setItem("email_remember",e.email):localStorage.setItem("email_remember",""),C.AccountLogin(e.email,e.password,{success:function(e){U[n]=e.identity,localStorage.setItem("identity_"+n,e.identity),q.goto(i.rx_forward),c(t)},failure:function(e){b(t,"AccountLogin Failed:"+e)}})}},q.aSU=function(n,e,i){n.onsubmit=function(e){e.preventDefault();var t=N(n);C.InitSetupAccount(t.email,{success:function(){localStorage.setItem("email",t.email),q.goto(i),c(n)},failure:function(e){b(n,"InitSetupAccount Failed:"+e)}})}},q.aSP=function(i,e,r){i.onsubmit=function(e){e.preventDefault();var n=N(i,!0);"email"in n||(n.email=localStorage.getItem("email")),C.InitCompleteAccount(n.email,!1,n.code,{success:function(e){var t=e.identity;C.AccountSetPassword(e.identity,n.password,{success:function(){localStorage.setItem("identity_default",t),q.goto(r),c(i)},failure:function(e){b(i,"Failed AccountSetPassword:"+e)}})},failure:function(e){b(i,"Failed InitCompleteAccount:"+e)}})}};return q.aCF=function(n,i){n.onsubmit=function(e){e.preventDefault();var e=N(n,!1),t=document.getElementById(i);t?(G(t,e),c(n)):b(n,"failed to find form by id '"+i+"'")}},q.aSD=function(t,n,i){t.onsubmit=function(e){e.preventDefault();e=N(t,!1);n.data.connection.ptr.send(i,e,{success:function(){c(t)},failure:function(e){b(t,"Send failed:"+e)}})}},q.TASK=function(e,t,n,i){var r=document.createElement("div");r.innerHTML="&#9744; "+i+" ( "+n+") <br />",e.appendChild(r)},q.SA=function(e,t,n){e.setAttribute(t,n)},q.HREF=function(e,n){e.setAttribute("href",a(n)),e.onclick=function(e){var t=(n.startsWith("/")?n.substring(1):n).split("/");return!S(t,0,V,{})||(e.preventDefault(),q.run(document.body,n,!0),!1)}},q.ACLASS=function(e,t){e.setAttribute("class",t)},q.ASRC=function(e,t){e.setAttribute("src",t)},window.rxhtml=q}();
