!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Adama=t():e.Adama=t()}(this,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t,n){(function(t){var n=null;"undefined"!=typeof WebSocket?n=WebSocket:"undefined"!=typeof MozWebSocket?n=MozWebSocket:void 0!==t?n=t.WebSocket||t.MozWebSocket:"undefined"!=typeof window?n=window.WebSocket||window.MozWebSocket:"undefined"!=typeof self&&(n=self.WebSocket||self.MozWebSocket),e.exports=n}).call(this,n(2))},function(e,t,n){"use strict";n.r(t),n.d(t,"Production",(function(){return c})),n.d(t,"Tree",(function(){return u})),n.d(t,"ConsoleLogSeqResponder",(function(){return a})),n.d(t,"TreePipeDataResponse",(function(){return d})),n.d(t,"Connection",(function(){return h}));var r=n(0),i=n.n(r),o=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function c(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}u((r=r.apply(e,t||[])).next())}))},s=function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},c="aws-us-east-2.adama-platform.com",u=function(){function e(){this.tree={},this.dispatch={},this.dispatch_count=0,this.queue=[],this.ondecide=function(e){}}return e.prototype.__recAppendChange=function(e,t,n,r){if(Array.isArray(t))for(var i=0;i<t.length;i++)this.__recAppendChange(e,t[i],n,r);else if("object"==typeof t)for(var o in t)o in e||(e[o]={}),this.__recAppendChange(e[o],t[o],n,r);else"function"==typeof t&&("@e"in e||(e["@e"]=[]),e["@e"].push({cb:t,order:n,auto_delete:r}))},e.prototype.__autoDelete=function(e){if("@e"in e){for(var t=e["@e"],n=[],r=0;r<t.length;r++)t[r].auto_delete||n.push(t[r]);e["@e"]=n}},e.prototype.onTreeChange=function(e){this.__recAppendChange(this.dispatch,e,this.dispatch_count,!1),this.dispatch_count++},e.prototype.mergeUpdate=function(e){"data"in e&&this.__recMergeAndDispatch(this.tree,this.dispatch,e.data),"outstanding"in e&&this.ondecide(e.outstanding),this.__drain()},e.prototype.__recDeleteAndDispatch=function(e,t){for(var n in e){var r=e[n];if(Array.isArray(r)){var i="#"+n;i in e&&i in t&&this.__recDeleteAndDispatch(e[i],t[i])}else n in t&&this.__recDeleteAndDispatch(r,t[n]);var o="-"+n;null!=t&&o in t&&this.__fire(t[o],{key:n,before:r,value:null})}},e.prototype.__recMergeAndDispatch=function(e,t,n){for(var r in n){var i=n[r];if(null!==i){var o=!(r in e);if("object"==typeof i){var s="@o"in i||"@s"in i;r in e||(s?(e[r]=[],e["#"+r]={}):e[r]={}),(s=Array.isArray(e[r])||s)?this.__recMergeAndDispatchArray(e[r],null!=t&&r in t?t[r]:null,e["#"+r],i):this.__recMergeAndDispatch(e[r],null!=t&&r in t?t[r]:null,i)}else{var c=r in e?e[r]:null;e[r]=i,null!=t&&r in t&&this.__fire(t[r],{key:r,before:c,value:i})}if(o){var u="+"+r;null!=t&&u in t&&this.__fire(t[u],{key:r,value:e[r]})}null!=t&&"@e"in t&&this.__fire(t,{value:e})}else{var a=e[r],d="-"+r;if(null!=t&&d in t&&this.__fire(t[d],{key:r,before:a,value:null}),Array.isArray(a)){var h="#"+r;h in e&&h in t&&this.__recDeleteAndDispatch(e[h],t[h]),delete e["#"+r]}else r in t&&this.__recDeleteAndDispatch(a,t[r]);delete e[r],null!=t&&r in t&&this.__fire(t[r],{key:r,before:a,value:null})}}},e.prototype.__recMergeAndDispatchArray=function(e,t,n,r){var i=null,o=null;for(var s in r)if("@o"==s)i=r[s];else if("@s"==s)o=r[s];else if(null==r[s])t&&"-"in t&&(s in t?this.__fire(t["-"],{key:s,before:n[s],value:null,clean:!0,clean_on:t[s]}):this.__fire(t["-"],{key:s,before:n[s],value:null})),delete n[s];else{var c=!1;null!=n&&s in n||(t&&"+"in t&&(c=!0),n[s]={}),n[s].__key=""+s,this.__recMergeAndDispatch(n[s],null!=t&&s in t?t[s]:null,r[s]),c?(s in t||(t[s]={}),this.__fire(t["+"],{key:s,before:null,value:n[s],append_result:!0,append_to:t[s]})):t&&"!"in t&&this.__fire(t["!"],{key:s,value:n[s]})}var u={before:e,value:e};if(null!==o){u.before=[];for(var a=0;a<e.length;a++)u.before.push(e[a]);e.length=o}if(null!==i){var d=[];u.before=[];var h=[];for(a=0;a<e.length;a++)u.before.push(e[a]);for(a=0;a<i.length;a++){var p=i[a],f=typeof p;if("string"==f||"number"==f)d.push(n[p]),h.push(""+p);else for(var l=p[0],_=p[1],y=l;y<=_;y++)h.push(e[y].__key),d.push(e[y])}t&&"^"in t&&this.__fire(t["^"],{new_order:h}),e.length=d.length;for(a=0;a<d.length;a++)e[a]=d[a]}this.__fire(t,u)},e.prototype.__fire=function(e,t){if(e&&"@e"in e){for(var n=e["@e"],r=0,i=0;i<n.length;i++){var o=n[i];null!==o?this.queue.push({cb:o.cb,order:o.order,change:t,dispatch_list:n,index:i}):r++}if(r>0){var s=[];for(i=0;i<n.length;i++)null!==o&&s.push(o);e["@e"]=s}}},e.prototype.__drain=function(){this.queue.sort((function(e,t){return e.order-t.order}));for(var e=0;e<this.queue.length;e++){var t=this.queue[e],n=t.cb(t.change);if(t.change.clean&&this.__autoDelete(t.change.clean_on),"delete"===n)t.dispatch_list[t.index]=null;else if(("function"==typeof n||"object"==typeof n||Array.isArray(n))&&t.change.append_result)if(Array.isArray(n))for(e=0;e<n.length;e++)this.__recAppendChange(t.change.append_to,n[e],t.order,!0);else this.__recAppendChange(t.change.append_to,n,t.order,!0)}this.queue=[]},e}(),a=function(){function e(e){this.prefix=e}return e.prototype.failure=function(e){console.log(this.prefix+"|error"+e)},e.prototype.success=function(e){console.log(this.prefix+"|success;seq="+e.seq)},e}(),d=function(){function e(e){this.tree=e}return e.prototype.next=function(e){this.tree.mergeUpdate(e.delta)},e.prototype.failure=function(e){console.log("tree|failure="+e)},e.prototype.complete=function(){},e}(),h=function(){function e(e){this.backoff=1,this.host=e,this.url="wss://"+e+"/s",this.assets=!0,this.connected=!1,this.dead=!1,this.maximum_backoff=2500,this.socket=null,this.onstatuschange=function(e){},this.onping=function(e,t){},this.onauthneeded=function(e){},this.scheduled=!1,this.callbacks=new Map,this.nextId=0,this.onreconnect=new Map,this.sessionId="",this.sendId=0}return e.prototype.stop=function(){this.dead=!0,null!==this.socket&&this.socket.close()},e.prototype._retry=function(){if(this.socket=null,this.connected&&(this.connected=!1,this.onstatuschange(!1)),this.callbacks.clear(),!this.dead&&!this.scheduled){var e=!1;this.backoff+=Math.random()*this.backoff,this.backoff>this.maximum_backoff&&(this.backoff=this.maximum_backoff,e=!0),this.scheduled=!0;var t=this;setTimeout((function(){t.start()}),this.backoff),e&&(this.backoff/=2)}},e.prototype.start=function(){var e=this;this.scheduled=!1,this.dead=!1,this.socket=new i.a(this.url),this.socket.onmessage=function(t){var n=JSON.parse(t.data);if("ping"in n)return e.onping(n.ping,n.latency),n.pong=(new Date).getTime()/1e3,void e.socket.send(JSON.stringify(n));if("status"in n)return"connected"!=n.status?(e.dead=!0,e.socket.close(),e.socket=null,void e.onauthneeded((function(){e.start()}))):(e.backoff=1,e.connected=!0,e.assets=n.assets,e.sessionId=n.session_id,e.onstatuschange(!0),e.ConfigureMakeOrGetAssetKey({success:function(t){try{var n=new XMLHttpRequest;n.open("GET","https://"+e.host+"/p"+t.assetKey,!0),n.withCredentials=!0,n.send()}catch(e){console.log(e)}},failure:function(){}}),void e._reconnect());if("failure"in n)e.callbacks.has(n.failure)&&(r=e.callbacks.get(n.failure))&&(e.callbacks.delete(n.failure),r(n));else if("deliver"in n){var r;if(e.callbacks.has(n.deliver))(r=e.callbacks.get(n.deliver))&&(n.done&&e.callbacks.delete(n.deliver),r(n))}},this.socket.onclose=function(t){e._retry()},this.socket.onerror=function(t){e._retry()}},e.prototype._write=function(e,t){this.connected?(this.callbacks.set(e.id,t),this.socket.send(JSON.stringify(e))):t({failure:600,reason:9999})},e.prototype.wait_connected=function(){return o(this,void 0,void 0,(function(){var e,t;return s(this,(function(n){return this.connected?[2,new Promise((function(e){e(!0)}))]:(e=this,t=this.onstatuschange,[2,new Promise((function(n){e.onstatuschange=function(r){t(r),r&&(n(!0),e.onstatuschange=t)}}))])}))}))},e.prototype._reconnect=function(){this.onreconnect.forEach((function(e,t){e.__retry()}))},e.prototype.__execute_rr=function(e){var t=this;return e.first=!0,t._write(e.request,(function(n){e.first&&(e.first=!1,"failure"in n?e.responder.failure(n.reason):e.responder.success(n.response)),t.onreconnect.delete(e.id)})),t.onreconnect.set(e.id,e),e.__retry=function(){t.__execute_rr(e)},e},e.prototype.__execute_stream=function(e){var t=this;return t._write(e.request,(function(n){if("failure"in n)return e.responder.failure(n.reason),void t.onreconnect.delete(e.id);n.response&&e.responder.next(n.response),n.done&&(e.responder.complete(),t.onreconnect.delete(e.id))})),t.onreconnect.set(e.id,e),e.__retry=function(){t.__execute_stream(e)},e},e.prototype.InitSetupAccount=function(e,t){this.nextId++;var n=this.nextId;return this.__execute_rr({id:n,responder:t,request:{method:"init/setup-account",id:n,email:e}})},e.prototype.InitCompleteAccount=function(e,t,n,r){this.nextId++;var i=this.nextId;return this.__execute_rr({id:i,responder:r,request:{method:"init/complete-account",id:i,email:e,revoke:t,code:n}})},e.prototype.AccountSetPassword=function(e,t,n){this.nextId++;var r=this.nextId;return this.__execute_rr({id:r,responder:n,request:{method:"account/set-password",id:r,identity:e,password:t}})},e.prototype.AccountLogin=function(e,t,n){this.nextId++;var r=this.nextId;return this.__execute_rr({id:r,responder:n,request:{method:"account/login",id:r,email:e,password:t}})},e.prototype.Probe=function(e,t){this.nextId++;var n=this.nextId;return this.__execute_rr({id:n,responder:t,request:{method:"probe",id:n,identity:e}})},e.prototype.AuthorityCreate=function(e,t){this.nextId++;var n=this.nextId;return this.__execute_rr({id:n,responder:t,request:{method:"authority/create",id:n,identity:e}})},e.prototype.AuthoritySet=function(e,t,n,r){this.nextId++;var i=this.nextId;return this.__execute_rr({id:i,responder:r,request:{method:"authority/set",id:i,identity:e,authority:t,"key-store":n}})},e.prototype.AuthorityGet=function(e,t,n){this.nextId++;var r=this.nextId;return this.__execute_rr({id:r,responder:n,request:{method:"authority/get",id:r,identity:e,authority:t}})},e.prototype.AuthorityList=function(e,t){this.nextId++;var n=this.nextId;return this.__execute_stream({id:n,responder:t,request:{method:"authority/list",id:n,identity:e}})},e.prototype.AuthorityDestroy=function(e,t,n){this.nextId++;var r=this.nextId;return this.__execute_rr({id:r,responder:n,request:{method:"authority/destroy",id:r,identity:e,authority:t}})},e.prototype.SpaceCreate=function(e,t,n){this.nextId++;var r=this.nextId;return this.__execute_rr({id:r,responder:n,request:{method:"space/create",id:r,identity:e,space:t}})},e.prototype.SpaceUsage=function(e,t,n,r){this.nextId++;var i=this.nextId;return this.__execute_stream({id:i,responder:r,request:{method:"space/usage",id:i,identity:e,space:t,limit:n}})},e.prototype.SpaceGet=function(e,t,n){this.nextId++;var r=this.nextId;return this.__execute_rr({id:r,responder:n,request:{method:"space/get",id:r,identity:e,space:t}})},e.prototype.SpaceSet=function(e,t,n,r){this.nextId++;var i=this.nextId;return this.__execute_rr({id:i,responder:r,request:{method:"space/set",id:i,identity:e,space:t,plan:n}})},e.prototype.SpaceDelete=function(e,t,n){this.nextId++;var r=this.nextId;return this.__execute_rr({id:r,responder:n,request:{method:"space/delete",id:r,identity:e,space:t}})},e.prototype.SpaceSetRole=function(e,t,n,r,i){this.nextId++;var o=this.nextId;return this.__execute_rr({id:o,responder:i,request:{method:"space/set-role",id:o,identity:e,space:t,email:n,role:r}})},e.prototype.SpaceReflect=function(e,t,n,r){this.nextId++;var i=this.nextId;return this.__execute_rr({id:i,responder:r,request:{method:"space/reflect",id:i,identity:e,space:t,key:n}})},e.prototype.SpaceList=function(e,t,n,r){this.nextId++;var i=this.nextId;return this.__execute_stream({id:i,responder:r,request:{method:"space/list",id:i,identity:e,marker:t,limit:n}})},e.prototype.DocumentCreate=function(e,t,n,r,i,o){this.nextId++;var s=this.nextId;return this.__execute_rr({id:s,responder:o,request:{method:"document/create",id:s,identity:e,space:t,key:n,entropy:r,arg:i}})},e.prototype.DocumentList=function(e,t,n,r,i){this.nextId++;var o=this.nextId;return this.__execute_stream({id:o,responder:i,request:{method:"document/list",id:o,identity:e,space:t,marker:n,limit:r}})},e.prototype.ConnectionCreate=function(e,t,n,r,i){var o=this;o.nextId++;var s=o.nextId;return o.__execute_stream({id:s,responder:i,request:{method:"connection/create",id:s,identity:e,space:t,key:n,"viewer-state":r},send:function(e,t,n){o.nextId++;var r=o.nextId;o.__execute_rr({id:r,responder:n,request:{method:"connection/send",id:r,connection:s,channel:e,message:t}})},update:function(e,t){o.nextId++;var n=o.nextId;o.__execute_rr({id:n,responder:t,request:{method:"connection/update",id:n,connection:s,"viewer-state":e}})},end:function(e){o.nextId++;var t=o.nextId;o.__execute_rr({id:t,responder:e,request:{method:"connection/end",id:t,connection:s}})}})},e.prototype.ConfigureMakeOrGetAssetKey=function(e){this.nextId++;var t=this.nextId;return this.__execute_rr({id:t,responder:e,request:{method:"configure/make-or-get-asset-key",id:t}})},e.prototype.AttachmentStart=function(e,t,n,r,i,o){var s=this;s.nextId++;var c=s.nextId;return s.__execute_stream({id:c,responder:o,request:{method:"attachment/start",id:c,identity:e,space:t,key:n,filename:r,"content-type":i},append:function(e,t,n){s.nextId++;var r=s.nextId;s.__execute_rr({id:r,responder:n,request:{method:"attachment/append",id:r,upload:c,"chunk-md5":e,"base64-bytes":t}})},finish:function(e){s.nextId++;var t=s.nextId;s.__execute_rr({id:t,responder:e,request:{method:"attachment/finish",id:t,upload:c}})}})},e}()},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n}])}));