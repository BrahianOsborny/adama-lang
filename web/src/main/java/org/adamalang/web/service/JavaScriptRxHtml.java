/*
 * This file is subject to the terms and conditions outlined in the file 'LICENSE' (hint: it's MIT); this file is located in the root directory near the README.md which you should also read.
 *
 * This file is part of the 'Adama' project which is a programming language and document store for board games; however, it can be so much more.
 *
 * See https://www.adama-platform.com/ for more information.
 *
 * (c) 2020 - 2022 by Jeffrey M. Barber ( http://jeffrey.io )
 */
package org.adamalang.web.service;

import java.util.Base64;

public class JavaScriptRxHtml {
  public static final byte[] RXHTML_JS_BYTES = Base64.getDecoder().decode("dmFyIFJ4SFRNTCA9IChmdW5jdGlvbiAoKSB7DQogIHZhciBzZWxmID0ge307DQoNCiAgdmFyIHRlbXBsYXRlcyA9IHt9Ow0KICB2YXIgcm91dGVyID0ge307DQogIHZhciBjb25uZWN0aW9uID0gbmV3IEFkYW1hLkNvbm5lY3Rpb24oQWRhbWEuUHJvZHVjdGlvbik7DQogIHZhciBjb25uZWN0aW9ucyA9IHt9Ow0KDQogIGNvbm5lY3Rpb24uc3RhcnQoKTsNCg0KICBjb25zb2xlLmxvZyh3aW5kb3cubG9jYXRpb24uaG9zdG5hbWUpOw0KICBjb25zb2xlLmxvZyh3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUpOw0KDQogIHZhciByb290UmVwbGFjZSA9ICIvIjsNCiAgdmFyIGZpeFBhdGggPSBmdW5jdGlvbihwYXRoKSB7IHJldHVybiBwYXRoOyB9Ow0KICBpZiAod2luZG93LmxvY2F0aW9uLmhvc3RuYW1lLmVuZHNXaXRoKCIuYWRhbWEtcGxhdGZvcm0uY29tIikpIHsNCiAgICB2YXIgcGFydHMgPSB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUuc3BsaXQoIi8iKTsNCiAgICByb290UmVwbGFjZSA9IFtwYXJ0c1swXSwgcGFydHNbMV0sIHBhcnRzWzJdLCAiIl0uam9pbigiLyIpOw0KICAgIHZhciBvZmZzZXQgPSBwYXJ0c1swXS5sZW5ndGggKyBwYXJ0c1sxXS5sZW5ndGggKyBwYXJ0c1syXS5sZW5ndGggKyAyOw0KICAgIGZpeFBhdGggPSBmdW5jdGlvbihwYXRoKSB7IHJldHVybiBwYXRoLnN1YnN0cmluZyhvZmZzZXQpOyB9DQogIH0NCg0KICB2YXIgZml4SHJlZiA9IGZ1bmN0aW9uKGhyZWYpIHsNCiAgICBpZiAoaHJlZi5zdGFydHNXaXRoKCcvJykpIHsNCiAgICAgIHJldHVybiByb290UmVwbGFjZSArIGhyZWYuc3Vic3RyaW5nKDEpOw0KICAgIH0NCiAgICByZXR1cm4gaHJlZjsNCiAgfQ0KDQoNCiAgdmFyIGdldF9jb25uZWN0aW9uX29iaiA9IGZ1bmN0aW9uKG5hbWUpIHsNCiAgICBpZiAobmFtZSBpbiBjb25uZWN0aW9ucykgew0KICAgICAgcmV0dXJuIGNvbm5lY3Rpb25zW25hbWVdOw0KICAgIH0gZWxzZSB7DQogICAgICB2YXIgb2JqID0gew0KICAgICAgICBuYW1lOiBuYW1lLA0KICAgICAgICBwdHI6IG51bGwsDQogICAgICAgIHRyZWU6IG5ldyBBZGFtYVRyZWVTaW1wbGUoKSwNCiAgICAgICAgb3V0c3RhbmRpbmc6IHt9LA0KICAgICAgICBkZWNpc2lvbnM6IHt9LA0KICAgICAgICBpZDowDQogICAgICB9Ow0KICAgICAgb2JqLnN1YnNjcmliZSA9IGZ1bmN0aW9uKGNoYW5uZWwsIGNhbGxiYWNrKSB7DQogICAgICAgIHZhciBzID0gY2hhbm5lbCArICJ8IiArIHRoaXMuaWQrKzsNCiAgICAgICAgdGhpcy5kZWNpc2lvbnNbc10gPSBjYWxsYmFjazsNCiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkgew0KICAgICAgICAgIGRlbGV0ZSB0aGlzLmRlY2lzaW9uc1tzXTsNCiAgICAgICAgfS5iaW5kKHRoaXMpOw0KICAgICAgfS5iaW5kKG9iaik7DQogICAgICBvYmoub25kZWNpZGUgPSBmdW5jdGlvbihvdXRzdGFuZGluZykgew0KICAgICAgICBmb3IgKHZhciBjaCBpbiBvYmoub3V0c3RhbmRpbmcpIHsNCiAgICAgICAgICBvYmoub3V0c3RhbmRpbmdbY2hdID0ge29wdGlvbnM6W119Ow0KICAgICAgICB9DQogICAgICAgIHZhciBuID0gb3V0c3RhbmRpbmcubGVuZ3RoOw0KICAgICAgICBmb3IgKHZhciBrID0gMDsgayA8IG47IGsrKykgew0KICAgICAgICAgIHZhciBvID0gb3V0c3RhbmRpbmdba107DQogICAgICAgICAgb2JqLm91dHN0YW5kaW5nW28uY2hhbm5lbF0gPSBvOw0KICAgICAgICB9DQogICAgICAgIGZvciAodmFyIGNoIGluIG9iai5vdXRzdGFuZGluZykgew0KICAgICAgICAgIGZvciAodmFyIHN1YiBpbiBvYmouZGVjaXNpb25zKSB7DQogICAgICAgICAgICBpZiAoc3ViLnN0YXJ0c1dpdGgoY2ggKyAifCIpKSB7DQogICAgICAgICAgICAgIG9iai5kZWNpc2lvbnNbc3ViXSgpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfTsNCiAgICAgIGNvbm5lY3Rpb25zW25hbWVdID0gb2JqOw0KICAgICAgcmV0dXJuIG9iajsNCiAgICB9DQogIH07DQoNCiAgc2VsZi5tYWtlID0gZnVuY3Rpb24oKSB7DQogICAgcmV0dXJuIG5ldyBBZGFtYVRyZWVTaW1wbGUoKTsNCiAgfTsNCg0KICAvLyBIRUxQRVIgfCBzdWJzY3JpYmUgdGhlIGdpdmVuICdzdWInIHRvIGNoYW5nZXMgd2l0aGluIHN0YXRlIGZvciB0aGUgZ2l2ZW4gZmllbGQgbmFtZWQgbmFtZQ0KICB2YXIgc3Vic2NyaWJlID0gZnVuY3Rpb24oc3RhdGUsIG5hbWUsIHN1Yikgew0KICAgIHZhciBzcyA9IHNlbGYucEkoc3RhdGUsIG5hbWUpOw0KICAgIHZhciBzID0gc3Nbc3MuY3VycmVudF07DQogICAgaWYgKCdAZScgaW4gcy5kZWx0YSkgew0KICAgICAgcy5kZWx0YVsnQGUnXS5wdXNoKHN1Yik7DQogICAgfSBlbHNlIHsNCiAgICAgIHMuZGVsdGFbJ0BlJ10gPSBbc3ViXTsNCiAgICB9DQogIH07DQoNCiAgLy8gSEVMUEVSIHwgY3JlYXRlIGZyZXNoIHN0YXRlDQogIHZhciBmcmVzaCA9IGZ1bmN0aW9uKHdoZXJlKSB7DQogICAgcmV0dXJuIHsNCiAgICAgIHRyZWU6bmV3IEFkYW1hVHJlZVNpbXBsZSgpLA0KICAgICAgZGVsdGE6e30sDQogICAgICBwYXJlbnQ6bnVsbCwNCiAgICAgIHBhdGg6bnVsbCwNCiAgICAgIHdoZXJlOndoZXJlDQogICAgfTsNCiAgfTsNCg0KICAvLyBIRUxQRVIgfCBjcmVhdGUgYSBuZXcgZGVsdGEgY29weSBmcm9tIHRoZSBnaXZlbiBzcGVjaWZpYyBzdGF0ZSAoaS5lLiBlaXRoZXIgZGF0YSBvciB2aWV3KQ0KICB2YXIgbmV3X2RlbHRhX2NvcHkgPSBmdW5jdGlvbihzcykgew0KICAgIGlmIChzcyA9PSBudWxsKSB7DQogICAgICByZXR1cm4gbnVsbDsNCiAgICB9DQogICAgdmFyIHBhcmVudCA9IG51bGw7DQogICAgaWYgKHNzLnBhcmVudCAhPSBudWxsKSB7DQogICAgICBwYXJlbnQgPSBuZXdfZGVsdGFfY29weShzcy5wYXJlbnQpOw0KICAgIH0NCiAgICB2YXIgbmV3X2RlbHRhID0ge307DQogICAgaWYgKHBhcmVudCAhPSBudWxsKSB7DQogICAgICBwYXJlbnQuZGVsdGFbc3MucGF0aF0gPSBuZXdfZGVsdGE7DQogICAgfQ0KICAgIHJldHVybiB7dHJlZTpzcy50cmVlLCBwYXJlbnQ6cGFyZW50LCBkZWx0YTpuZXdfZGVsdGEsIHBhdGg6c3MucGF0aH07DQogIH07DQoNCiAgLy8gSEVMUEVSIHwgY29uc3RydWN0IGEgcGF0aCB0bw0KICB2YXIgcGF0aF90byA9IGZ1bmN0aW9uKHNzLCBvYmopIHsNCiAgICBpZiAoc3MucGFyZW50ICE9IG51bGwpIHsNCiAgICAgIHZhciBwYXJlbnQgPSBwYXRoX3RvKHNzLnBhcmVudCwge30pOw0KICAgICAgcGFyZW50W3NzLnBhdGhdID0gb2JqOw0KICAgICAgcmV0dXJuIHBhcmVudDsNCiAgICB9IGVsc2Ugew0KICAgICAgcmV0dXJuIG9iajsNCiAgICB9DQogIH07DQoNCiAgLy8gSEVMUEVSIHwgZ2V0IHRoZSByb290IG9mIHRoZSBzcGVjaWZpYyBzdGF0ZSAoaS5lLiBlaXRoZXIgdGhlIGRhdGEncyByb290IG9yIHRoZSB2aWV3J3Mgcm9vdCkNCiAgdmFyIHJvb3Rfb2YgPSBmdW5jdGlvbihzcykgew0KICAgIHZhciB4ID0gc3M7DQogICAgd2hpbGUgKHgucGFyZW50ICE9IG51bGwpIHsNCiAgICAgIHggPSB4LnBhcmVudDsNCiAgICB9DQogICAgcmV0dXJuIHg7DQogIH0NCg0KICAvLyBIRUxQRVIgfCByZW1vdmUgYWxsIHRoZSBjaGlsZHJlbiBmcm9tIHRoZSBnaXZlbiBET00gbm9kZQ0KICB2YXIgbnVrZSA9IGZ1bmN0aW9uKHBhcmVudCkgew0KICAgIHZhciBsYXN0ID0gcGFyZW50Lmxhc3RDaGlsZDsgDQogICAgd2hpbGUgKGxhc3QpIHsNCiAgICAgIHBhcmVudC5yZW1vdmVDaGlsZChsYXN0KTsNCiAgICAgIGxhc3QgPSBwYXJlbnQubGFzdENoaWxkOw0KICAgIH0NCiAgfTsNCg0KICAvLyBIRUxQRVI6IGRlYm91bmNlIHRoZSBnaXZlbiBmdW5jdGlvbmFsIHdoZW4gcmFwaWQgZnVuY3Rpb24gc3ByZWFkIGlzIGV4cGVjdGVkDQogIHZhciBkZWJvdW5jZSA9IGZ1bmN0aW9uKG1zLCBmb28pIHsNCiAgICB2YXIgc3RhdHVzID0ge2luZmxpZ2h0OmZhbHNlLCB0aW1lb3V0Om51bGx9Ow0KICAgIHN0YXR1cy5pbmZsaWdodCA9IGZhbHNlOw0KICAgIHJldHVybiBmdW5jdGlvbigpIHsNCiAgICAgIGlmICghc3RhdHVzLmluZmxpZ2h0KSB7DQogICAgICAgIHN0YXR1cy5pbmZsaWdodCA9IHRydWU7DQogICAgICAgIHN0YXR1cy50aW1lb3V0ID0gd2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24oKSB7DQogICAgICAgICAgc3RhdHVzLmluZmxpZ2h0ID0gZmFsc2U7DQogICAgICAgICAgc3RhdHVzLnRpbWVvdXQgPSBudWxsOw0KICAgICAgICAgIGZvbygpOw0KICAgICAgICB9LCBtcyAvKiBtcyAqLyk7IC8vIGRlYm91bmNlIHRoZSBwYXJhbWV0ZXJzDQogICAgICB9DQogICAgfTsNCiAgfTsNCg0KICAvLyBIRUxQRVIgfCBwcmVwYXJlIGEgZnJlZSB1bnN1YnNjcmliZSBvYmplY3QNCiAgdmFyIG1ha2VfdW5zdWIgPSBmdW5jdGlvbigpIHsNCiAgICByZXR1cm4ge19fZGF0YTogZnVuY3Rpb24oKSB7fSwgX192aWV3OiBmdW5jdGlvbigpIHt9fTsNCiAgfTsNCg0KICAvLyBIRUxQRVIgfCBhdWdtZW50IGFuIGV4aXN0aW5nIG9iamVjdCB3aXRoIHVuc3Vic2NyaWJlIGRhdGENCiAgdmFyIGFkZF91bnN1YiA9IGZ1bmN0aW9uKG9iaikgew0KICAgIG9iai5fX2RhdGEgPSBmdW5jdGlvbigpIHt9Ow0KICAgIG9iai5fX3ZpZXcgPSBmdW5jdGlvbigpIHt9Ow0KICB9DQoNCiAgLy8gSEVMUEVSIHwgZmlyZSB0aGUgdW5zdWJzY3JpYmUgY2FsbHMgd2l0aGluIGFuIG9iamVjdA0KICB2YXIgZmlyZV91bnN1YiA9IGZ1bmN0aW9uKHVuc3ViKSB7DQogICAgdW5zdWIuX19kYXRhKCk7DQogICAgdW5zdWIuX192aWV3KCk7DQogIH0NCg0KICAvLyBIRUxQRVIgfCBzdWJzY3JpYmUgdG8gc3RhdGUgYW5kIHBvcHVsYXRlIHVuc3Vic2NyaWJlIG9iamVjdA0KICB2YXIgc3Vic2NyaWJlX3N0YXRlID0gZnVuY3Rpb24oc3RhdGUsIHVuc3ViKSB7DQogICAgaWYgKHN0YXRlLmRhdGEgIT0gbnVsbCkgew0KICAgICAgdW5zdWIuX19kYXRhID0gc3RhdGUuZGF0YS50cmVlLnN1YnNjcmliZShyb290X29mKHN0YXRlLmRhdGEpLmRlbHRhKTsNCiAgICB9IGVsc2Ugew0KICAgICAgdW5zdWIuX19kYXRhID0gZnVuY3Rpb24oKSB7fTsNCiAgICB9DQogICAgaWYgKHN0YXRlLnZpZXcgIT0gbnVsbCkgew0KICAgICAgdW5zdWIuX192aWV3ID0gc3RhdGUudmlldy50cmVlLnN1YnNjcmliZShyb290X29mKHN0YXRlLnZpZXcpLmRlbHRhKTsgDQogICAgfSBlbHNlIHsNCiAgICAgIHVuc3ViLl9fdmlldyA9IGZ1bmN0aW9uKCkge307DQogICAgfQ0KICB9Ow0KDQogIHZhciBzdWJzY3JpYmVfdmlldyA9IGZ1bmN0aW9uKHN0YXRlLCB1bnN1Yikgew0KICAgIGlmIChzdGF0ZS52aWV3ICE9IG51bGwpIHsNCiAgICAgIHVuc3ViLl9fdmlldyA9IHN0YXRlLnZpZXcudHJlZS5zdWJzY3JpYmUocm9vdF9vZihzdGF0ZS52aWV3KS5kZWx0YSk7IA0KICAgIH0gZWxzZSB7DQogICAgICB1bnN1Yi5fX3ZpZXcgPSBmdW5jdGlvbigpIHt9Ow0KICAgIH0NCiAgfTsNCg0KICAvLyBSVU5USU1FIHwgU3dpdGNoIHRvIHRoZSB2aWV3IG9iamVjdA0KICBzZWxmLnBWID0gZnVuY3Rpb24oc3RhdGUpIHsNCiAgICByZXR1cm4ge3NlcnZpY2U6c3RhdGUuc2VydmljZSwgZGF0YTpzdGF0ZS5kYXRhLCB2aWV3OnN0YXRlLnZpZXcsIGN1cnJlbnQ6J3ZpZXcnfTsNCiAgfTsNCg0KICAvLyBSVU5USU1FIHwgU3dpdGNoIHRvIHRoZSBkYXRhIG9iamVjdA0KICBzZWxmLnBEID0gZnVuY3Rpb24oc3RhdGUpIHsNCiAgICByZXR1cm4ge3NlcnZpY2U6IHN0YXRlLnNlcnZpY2UsIGRhdGE6c3RhdGUuZGF0YSwgdmlldzpzdGF0ZS52aWV3LCBjdXJyZW50OidkYXRhJ307DQogIH07DQoNCiAgLy8gUlVOVElNRSB8IFN3aXRjaCB0byB0aGUgcm9vdCBvYmplY3QgLyAoUm9vdCkNCiAgc2VsZi5wUiA9IGZ1bmN0aW9uKHN0YXRlKSB7DQogICAgdmFyIG5leHQgPSB7c2VydmljZTogc3RhdGUuc2VydmljZSwgZGF0YTpzdGF0ZS5kYXRhLCB2aWV3OnN0YXRlLnZpZXcsIGN1cnJlbnQ6c3RhdGUuY3VycmVudH07DQogICAgdmFyIHByaW9yID0gbmV4dFtzdGF0ZS5jdXJyZW50XTsNCiAgICB3aGlsZSAocHJpb3IucGFyZW50ICE9IG51bGwpIHsNCiAgICAgIGlmIChwcmlvci5wYXJlbnQgPT0gbnVsbCkgew0KICAgICAgICBuZXh0W3N0YXRlLmN1cnJlbnRdDQogICAgICAgIHJldHVybiBwcmlvcjsNCiAgICAgIH0NCiAgICAgIHByaW9yID0gcHJpb3IucGFyZW50Ow0KICAgIH0NCiAgICBuZXh0W3N0YXRlLmN1cnJlbnRdID0gcHJpb3I7DQogICAgcmV0dXJuIG5leHQ7DQogIH07DQoNCiAgLy8gUlVOVElNRSB8IC4uLyAoVXApDQogIHNlbGYucFUgPSBmdW5jdGlvbihzdGF0ZSkgew0KICAgIHZhciBuZXh0ID0ge3NlcnZpY2U6IHN0YXRlLnNlcnZpY2UsIGRhdGE6c3RhdGUuZGF0YSwgdmlldzpzdGF0ZS52aWV3LCBjdXJyZW50OnN0YXRlLmN1cnJlbnR9Ow0KICAgIHZhciBwcmlvciA9IG5leHRbc3RhdGUuY3VycmVudF07DQogICAgaWYgKHByaW9yLnBhcmVudCAhPSBudWxsKSB7DQogICAgICBuZXh0W3N0YXRlLmN1cnJlbnRdID0gcHJpb3I7DQogICAgfQ0KICAgIHJldHVybiBuZXh0Ow0KICB9Ow0KDQogIC8vIFJVTlRJTUUgfCBkaXZlIG9uZSBsZXZlbCBJbnRvIHBhdGgxL3BhdGgyLy4uLi4vcGF0aE4NCiAgc2VsZi5wSSA9IGZ1bmN0aW9uKHN0YXRlLCBuYW1lKSB7DQogICAgdmFyIHByaW9yID0gc3RhdGVbc3RhdGUuY3VycmVudF07DQogICAgaWYgKCEobmFtZSBpbiBwcmlvci5kZWx0YSkpIHsNCiAgICAgIHByaW9yLmRlbHRhW25hbWVdID0ge307DQogICAgfQ0KICAgIHZhciBuZXh0ID0ge3NlcnZpY2U6IHN0YXRlLnNlcnZpY2UsIGRhdGE6c3RhdGUuZGF0YSwgdmlldzpzdGF0ZS52aWV3LCBjdXJyZW50OnN0YXRlLmN1cnJlbnR9Ow0KICAgIG5leHRbc3RhdGUuY3VycmVudF0gPSB7DQogICAgICB0cmVlOnByaW9yLnRyZWUsDQogICAgICBkZWx0YTpwcmlvci5kZWx0YVtuYW1lXSwNCiAgICAgIHBhcmVudDpwcmlvciwNCiAgICAgIHBhdGg6bmFtZSwNCiAgICB9Ow0KICAgIGlmIChuZXh0LmN1cnJlbnQgPT0gImRhdGEiKSB7DQogICAgICBuZXh0LmRhdGEuY29ubmVjdGlvbiA9IHByaW9yLmNvbm5lY3Rpb247DQogICAgfQ0KICAgIHJldHVybiBuZXh0Ow0KICB9Ow0KDQogIC8vIFJVTlRJTUUgfCBleHRlbmQgdGhlIGdpdmVuIHN0YXRlIHdpdGggdGhlIHZpZXcgaGF2aW5nIGEgc2VwZXJhdGUgY2hpbGQNCiAgc2VsZi5wRVYgPSBmdW5jdGlvbihzdGF0ZSwgbmFtZSkgew0KICAgIGlmICghKG5hbWUgaW4gc3RhdGUudmlldy5kZWx0YSkpIHsNCiAgICAgIHN0YXRlLnZpZXcuZGVsdGFbbmFtZV0gPSB7fTsNCiAgICB9DQogICAgcmV0dXJuIHsNCiAgICAgIHNlcnZpY2U6IHN0YXRlLnNlcnZpY2UsDQogICAgICBkYXRhOiBzdGF0ZS5kYXRhLA0KICAgICAgdmlldzogew0KICAgICAgICB0cmVlOnN0YXRlLnZpZXcudHJlZSwNCiAgICAgICAgZGVsdGE6c3RhdGUudmlldy5kZWx0YVtuYW1lXSwNCiAgICAgICAgcGFyZW50OnN0YXRlLnZpZXcsDQogICAgICAgIHBhdGg6bmFtZSwNCiAgICAgIH0sDQogICAgICBjdXJyZW50OnN0YXRlLmN1cnJlbnQNCiAgICB9Ow0KICB9Ow0KDQogIHZhciBmb3JrID0gZnVuY3Rpb24ocHJpb3JTdGF0ZSkgew0KICAgIHZhciBzdGF0ZSA9IHsNCiAgICAgIHNlcnZpY2U6IHByaW9yU3RhdGUuc2VydmljZSwNCiAgICAgIGRhdGE6IG5ld19kZWx0YV9jb3B5KHByaW9yU3RhdGUuZGF0YSksDQogICAgICB2aWV3OiBuZXdfZGVsdGFfY29weShwcmlvclN0YXRlLnZpZXcpLA0KICAgICAgY3VycmVudDpwcmlvclN0YXRlLmN1cnJlbnQNCiAgICB9Ow0KICAgIGlmIChzdGF0ZS5kYXRhICE9IG51bGwpIHsNCiAgICAgIHN0YXRlLmRhdGEuY29ubmVjdGlvbiA9IHByaW9yU3RhdGUuZGF0YS5jb25uZWN0aW9uOw0KICAgIH0NCiAgICByZXR1cm4gc3RhdGU7DQogIH0NCg0KICAvLyBSVU5USU1FIHwgc3Vic2NyaWJlIGJldHdlZW4gdGhlIHN0YXRlIGFuZCB0aGUgb2JqZWN0Lg0KICAvLyBXaGVuIHRoZSBtZW1iZXIgZmllbGQgd2l0aGluIHN0YXRlIG9mIG5hbWUgY2hhbmdlcywgY29weSB0aGF0IHZhbHVlIGludG8gdGhlIG9iaiBhbmQgcnVuIHJlY29tcHV0ZSgpDQogIHNlbGYuWSA9IGZ1bmN0aW9uKHN0YXRlLCBvYmosIG5hbWUsIHJlY29tcHV0ZSkgew0KICAgIHZhciBzdWIgPSBmdW5jdGlvbih2YWx1ZSkgew0KICAgICAgb2JqW25hbWVdID0gdmFsdWU7DQogICAgICByZWNvbXB1dGUoKTsNCiAgICB9Ow0KICAgIHN1YnNjcmliZShzdGF0ZSwgbmFtZSwgc3ViKTsNCiAgfTsNCg0KICAvLyBSVU5USU1FIHwgSnVzdCBzdWJzY3JpYmVlIHZhbHVlIHRvIHRoZSBvYmplY3QgZmllbGQgb2YgbmFtZSAobm8tcmVjb21wdXRlKQ0KICBzZWxmLllTID0gZnVuY3Rpb24oc3RhdGUsIG9iaiwgbmFtZSkgew0KICAgIHZhciBzdWIgPSBmdW5jdGlvbih2YWx1ZSkgew0KICAgICAgb2JqW25hbWVdID0gdmFsdWU7DQogICAgfTsNCiAgICBzdWJzY3JpYmUoc3RhdGUsIG5hbWUsIHN1Yik7DQogIH07DQoNCiAgLy8gUlVOVElNRSB8ICJUZXh0Ig0KICBzZWxmLlQgPSBmdW5jdGlvbih0eCkgew0KICAgIHJldHVybiBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSh0eCk7DQogIH07DQoNCiAgLy8gUlVOVElNRSB8IDxsb29rdXAgcGF0aD0uLi4+DQogIHNlbGYuTCA9IGZ1bmN0aW9uKHN0YXRlLCBuYW1lKSB7DQogICAgdmFyIGRvbSA9IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCIiKTsNCiAgICB2YXIgc3ViID0gZnVuY3Rpb24odmFsdWUpIHsgZG9tLm5vZGVWYWx1ZSA9IHZhbHVlOyB9Ow0KICAgIHN1YnNjcmliZShzdGF0ZSwgbmFtZSwgc3ViKTsNCiAgICByZXR1cm4gZG9tOw0KICB9Ow0KDQogIC8vIFJVTlRJTUUgfCA8bG9va3VwIHBhdGg9Li4uIHRyYW5zZm9ybT0iJHRyYW5zZm9ybSIgLz4NCiAgc2VsZi5MVCA9IGZ1bmN0aW9uKHN0YXRlLCBuYW1lLCB0cmFuc2Zvcm0pIHsNCiAgICB2YXIgZG9tID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoIiIpOw0KICAgIHZhciBzdWIgPSBmdW5jdGlvbih2YWx1ZSkgeyBkb20ubm9kZVZhbHVlID0gdHJhbnNmb3JtKHZhbHVlKTsgfTsNCiAgICBzdWJzY3JpYmUoc3RhdGUsIG5hbWUsIHN1Yik7DQogICAgcmV0dXJuIGRvbTsNCiAgfTsNCg0KICAvLyBSVU5USU1FIHwgPHRhZz4NCiAgc2VsZi5FID0gZnVuY3Rpb24odGFnLCBucykgew0KICAgIGlmIChucyA9PSB1bmRlZmluZWQgfHwgbnMgPT0gbnVsbCkgew0KICAgICAgcmV0dXJuIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTsNCiAgICB9IGVsc2Ugew0KICAgICAgdmFyIHJlc3VsdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhucywgdGFnKTsNCiAgICAgIHJlc3VsdC5zZXRBdHRyaWJ1dGUoJ3htbG5zJywgbnMpOw0KICAgICAgcmV0dXJuIHJlc3VsdDsNCiAgICB9DQogIH07DQoNCiAgLy8gUlVOVElNRSB8IDxwaWNrIG5hbWU9Li4uPg0KICBzZWxmLlAgPSBmdW5jdGlvbihwYXJlbnQsIHByaW9yU3RhdGUsIHJ4T2JqLCBjaGlsZE1ha2VyKSB7DQogICAgdmFyIHVuc3ViID0gbWFrZV91bnN1YigpOw0KICAgIHJ4T2JqLl9fID0gZnVuY3Rpb24oKSB7DQogICAgICBpZiAodGhpcy5uYW1lID09IHJ4T2JqLm5hbWUpIHsgcmV0dXJuOyB9DQogICAgICBmaXJlX3Vuc3ViKHVuc3ViKTsNCiAgICAgIHRoaXMubmFtZSA9IHJ4T2JqLm5hbWU7DQogICAgICB2YXIgY28gPSBnZXRfY29ubmVjdGlvbl9vYmoocnhPYmoubmFtZSk7DQogICAgICBudWtlKHBhcmVudCk7DQogICAgICB2YXIgc3RhdGUgPSB7DQogICAgICAgIHNlcnZpY2U6IHByaW9yU3RhdGUuc2VydmljZSwNCiAgICAgICAgZGF0YToge2Nvbm5lY3Rpb246IGNvLCB0cmVlOmNvLnRyZWUsIGRlbHRhOnt9LCBwYXJlbnQ6bnVsbCwgcGF0aDpudWxsfSwNCiAgICAgICAgdmlldzogbmV3X2RlbHRhX2NvcHkocHJpb3JTdGF0ZS52aWV3KSwNCiAgICAgICAgY3VycmVudDonZGF0YScNCiAgICAgIH07DQogICAgICBjaGlsZE1ha2VyKHN0YXRlKTsNCiAgICAgIHN1YnNjcmliZV9zdGF0ZShzdGF0ZSwgdW5zdWIpOw0KICAgIH0uYmluZCh7bmFtZToiIn0pOw0KICB9Ow0KDQogIC8vIFJVTlRJTUUgfCA8dGVtcGxhdGUgbmFtZT0iLi4uIj4NCiAgc2VsZi5UUCA9IGZ1bmN0aW9uKG5hbWUsIGZvbykgew0KICAgIHRlbXBsYXRlc1tuYW1lXSA9IGZvbzsNCiAgfTsNCg0KICAvLyBSVU5USU1FIHwgPC4uLiBocmVmPSIiIC4uLj4NCiAgc2VsZi5IUkVGID0gZnVuY3Rpb24oZG9tLCBocmVmKSB7DQogICAgZG9tLnNldEF0dHJpYnV0ZSgnaHJlZicsIGZpeEhyZWYoaHJlZikpOw0KICAgIGRvbS5vbmNsaWNrID0gZnVuY3Rpb24oZXZ0KSB7DQogICAgICB2YXIgcGFydHMgPSAoaHJlZi5zdGFydHNXaXRoKCIvIikgPyBocmVmLnN1YnN0cmluZygxKSA6IGhyZWYpLnNwbGl0KCIvIik7DQogICAgICBpZiAocm91dGUocGFydHMsIDAsIHJvdXRlciwge30pKSB7DQogICAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgICBzZWxmLnJ1bihkb2N1bWVudC5ib2R5LCBocmVmLCB0cnVlKTsNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgfQ0KICAgICAgcmV0dXJuIHRydWU7DQogICAgfTsNCiAgfTsNCiAgLy8gUlVOVElNRSB8IDwuLi4gY2xhc3M9IiIgLi4uPg0KICBzZWxmLkFDTEFTUyA9IGZ1bmN0aW9uKGRvbSwgdmFsdWUpIHsNCiAgICBkb20uc2V0QXR0cmlidXRlKCdjbGFzcycsIHZhbHVlKTsNCiAgfTsNCiAgLy8gUlVOVElNRSB8IDwuLi4gc3JjPSIiIC4uLj4NCiAgc2VsZi5BU1JDID0gZnVuY3Rpb24oZG9tLCB2YWx1ZSkgew0KICAgIGRvbS5zZXRBdHRyaWJ1dGUoJ3NyYycsIHZhbHVlKTsNCiAgfTsNCg0KICAvLyBSVU5USU1FIHwgPHRhZyByeDp0ZW1wbGF0ZT0kbmFtZT4NCiAgc2VsZi5VVCA9IGZ1bmN0aW9uKHBhcmVudCwgc3RhdGUsIG5hbWUsIGNoaWxkX21ha2VyKSB7DQogICAgdmFyIGZvbyA9IHRlbXBsYXRlc1tuYW1lXTsNCiAgICBmb28ocGFyZW50LCBzdGF0ZSwgY2hpbGRfbWFrZXIpOw0KICB9Ow0KDQogIC8vIFJVTlRJTUUgfCA8dGFnIHJ4OnN3aXRjaD1wYXRoIC4uPg0KICBzZWxmLlNXID0gZnVuY3Rpb24ocGFyZW50LCBwcmlvclN0YXRlLCBuYW1lLCBjaGlsZHJlbk1ha2VyKSB7DQogICAgdmFyIHN3c3QgPSB7cHJpb3I6bnVsbH07DQogICAgYWRkX3Vuc3ViKHN3c3QpOw0KICAgIHZhciBzdWIgPSBmdW5jdGlvbih2YWx1ZSkgew0KICAgICAgaWYgKHZhbHVlID09IHRoaXMucHJpb3IpIHsNCiAgICAgICAgcmV0dXJuOw0KICAgICAgfQ0KICAgICAgdGhpcy5wcmlvciA9IHZhbHVlOw0KICAgICAgZmlyZV91bnN1Yih0aGlzKTsNCiAgICAgIG51a2UocGFyZW50KTsNCiAgICAgIHZhciBzdGF0ZSA9IGZvcmsocHJpb3JTdGF0ZSk7DQogICAgICBjaGlsZHJlbk1ha2VyKHBhcmVudCwgc3RhdGUsICcnICsgdmFsdWUpOw0KICAgICAgc3Vic2NyaWJlX3N0YXRlKHN0YXRlLCB0aGlzKTsNCg0KICAgIH0uYmluZChzd3N0KTsNCiAgICBzdWJzY3JpYmUocHJpb3JTdGF0ZSwgbmFtZSwgc3ViKTsNCiAgfTsNCg0KICAvLyBSVU5USU1FIHwgPHRhZyByeDppdGVyYXRlPXBhdGggLi4uPg0KICBzZWxmLklUID0gZnVuY3Rpb24ocGFyZW50RG9tLCBzdGF0ZSwgbmFtZSwgZXhwYW5kVmlldywgbWFrZXIpIHsNCiAgICB2YXIgaXRfc3RhdGUgPSBzZWxmLnBJKHN0YXRlLCBuYW1lKTsNCiAgICB2YXIgZG9tQnlLZXkgPSB7fTsNCiAgICB2YXIgdmlld1VuU3ViQnlLZXkgPSB7fTsNCg0KICAgIHZhciBzdWIgPSB7DQogICAgICAnKyc6IGZ1bmN0aW9uKGtleSkgew0KICAgICAgICAvLyBUT0RPOiB2aWV3IHByb3BhZ2F0ZXMgZG9uJ3Qgd29yayBoZXJlDQogICAgICAgIHZhciBuZXdfc3RhdGUgPSBzZWxmLnBJKGl0X3N0YXRlLCBrZXkpOw0KICAgICAgICBpZiAoZXhwYW5kVmlldykgew0KICAgICAgICAgIG5ld19zdGF0ZSA9IHNlbGYucEVWKGl0X3N0YXRlLCBrZXkpOw0KICAgICAgICB9DQogICAgICAgIG5ld19zdGF0ZSA9IHsNCiAgICAgICAgICBzZXJ2aWNlOiBuZXdfc3RhdGUuc2VydmljZSwNCiAgICAgICAgICBkYXRhOiBuZXdfc3RhdGUuZGF0YSwNCiAgICAgICAgICB2aWV3OiBuZXdfZGVsdGFfY29weShuZXdfc3RhdGUudmlldyksDQogICAgICAgICAgY3VycmVudDpuZXdfc3RhdGUuY3VycmVudA0KICAgICAgICB9Ow0KICAgICAgICANCiAgICAgICAgdmFyIHVuc3ViID0gbWFrZV91bnN1YigpOw0KICAgICAgICB2YXIgZG9tID0gbWFrZXIobmV3X3N0YXRlKTsNCiAgICAgICAgZG9tQnlLZXlba2V5XSA9IGRvbTsNCiAgICAgICAgdmlld1VuU3ViQnlLZXlba2V5XSA9IHVuc3ViOw0KICAgICAgICBwYXJlbnREb20uYXBwZW5kKGRvbSk7DQogICAgICAgIHN1YnNjcmliZV92aWV3KG5ld19zdGF0ZSwgdW5zdWIpOw0KICAgICAgICByZXR1cm4gbmV3X3N0YXRlW25ld19zdGF0ZS5jdXJyZW50XS5kZWx0YTsNCiAgICAgIH0sDQogICAgICAnLSc6IGZ1bmN0aW9uKGtleSkgew0KICAgICAgICBpZiAoa2V5IGluIGRvbUJ5S2V5KSB7DQogICAgICAgICAgcGFyZW50RG9tLnJlbW92ZUNoaWxkKGRvbUJ5S2V5W2tleV0pOw0KICAgICAgICAgIGRlbGV0ZSBkb21CeUtleVtrZXldOw0KICAgICAgICB9DQogICAgICAgIGlmIChrZXkgaW4gdmlld1VuU3ViQnlLZXkpIHsNCiAgICAgICAgICBmaXJlX3Vuc3ViKHZpZXdVblN1YkJ5S2V5W2tleV0pOw0KICAgICAgICAgIGRlbGV0ZSB2aWV3VW5TdWJCeUtleVtrZXldOw0KICAgICAgICB9DQogICAgICB9LA0KICAgICAgJ34nOiBmdW5jdGlvbihvcmQpIHsNCiAgICAgICAgbnVrZShwYXJlbnREb20pOw0KICAgICAgICBmb3IgKHZhciBrID0gMDsgayA8IG9yZC5sZW5ndGg7IGsrKykgew0KICAgICAgICAgIHBhcmVudERvbS5hcHBlbmQoZG9tQnlLZXlbb3JkW2tdXSk7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9Ow0KICAgIHN1YnNjcmliZShzdGF0ZSwgbmFtZSwgc3ViKTsNCiAgfTsNCg0KICB2YXIgZmluZCA9IGZ1bmN0aW9uKHN0YXRlLCBjaGFubmVsLCBrZXksIHZhbHVlKSB7DQogICAgaWYgKGNoYW5uZWwgaW4gc3RhdGVbJ2RhdGEnXS5jb25uZWN0aW9uLm91dHN0YW5kaW5nKSB7DQogICAgICB2YXIgYXJyID0gc3RhdGVbJ2RhdGEnXS5jb25uZWN0aW9uLm91dHN0YW5kaW5nW2NoYW5uZWxdLm9wdGlvbnM7DQogICAgICBmb3IgKHZhciBrID0gMDsgayA8IGFyci5sZW5ndGg7IGsrKykgew0KICAgICAgICB2YXIgcyA9IGFycltrXTsNCiAgICAgICAgaWYgKGtleSBpbiBzICYmIHNba2V5XSA9PSB2YWx1ZSkgew0KICAgICAgICAgIHJldHVybiBzOw0KICAgICAgICB9IA0KICAgICAgfQ0KICAgICAgcmV0dXJuIG51bGw7DQogICAgfSBlbHNlIHsNCiAgICAgIHJldHVybiBudWxsOw0KICAgIH0NCiAgfTsNCg0KICB2YXIgY3VzdG9tcyA9IHt9Ow0KDQogIHNlbGYuUFJDVUFDID0gZnVuY3Rpb24obmFtZSwgZm9vKSB7DQogICAgY3VzdG9tc1tuYW1lXSA9IGZvbzsNCiAgfTsNCg0KICBzZWxmLmV4Q0MgPSBmdW5jdGlvbihkb20sIHR5cGUsIHN0YXRlLCBjdXN0b21Db21tYW5kTmFtZSkgew0KICAgIGRvbS5hZGRFdmVudExpc3RlbmVyKHR5cGUsIGZ1bmN0aW9uKCkgew0KICAgICAgaWYgKGN1c3RvbUNvbW1hbmROYW1lIGluIGN1c3RvbXMpIHsNCiAgICAgICAgY3VzdG9tc1tjdXN0b21Db21tYW5kTmFtZV0oKTsNCiAgICAgIH0NCiAgICB9KTsNCiAgfTsNCg0KICBzZWxmLmFDQyA9IGZ1bmN0aW9uKGZvcm0sIHN0YXRlLCBjdXN0b21Db21tYW5kTmFtZSwgc3RhdHVzVmFyKSB7DQogICAgdmFyIHNpZ25hbCA9IG1ha2VfZmFpbHVyZV9zaWduYWwoc3RhdGUsIHN0YXR1c1Zhcik7DQogICAgZm9ybS5vbnN1Ym1pdCA9IGZ1bmN0aW9uKGV2dCkgew0KICAgICAgaWYgKGN1c3RvbUNvbW1hbmROYW1lIGluIGN1c3RvbXMpIHsNCiAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgIHZhciBvYmogPSBnZXRfZm9ybShmb3JtKTsNCiAgICAgICAgY3VzdG9tc1tjdXN0b21Db21tYW5kTmFtZV0ob2JqLCBzdGF0ZSwgc2lnbmFsLCBzZWxmKTsNCiAgICAgIH0NCiAgICB9Ow0KICB9Ow0KDQogIHNlbGYuZXhEID0gZnVuY3Rpb24oZG9tLCB0eXBlLCBzdGF0ZSwgbmFtZSwgY2hhbm5lbCwga2V5KSB7DQogICAgdmFyIGRlY2lkZSA9IHsgdmFsdWU6IG51bGwgfTsNCiAgICBkb20uYWRkRXZlbnRMaXN0ZW5lcih0eXBlLCBmdW5jdGlvbigpIHsNCiAgICAgIHZhciByZXN1bHQgPSBmaW5kKHN0YXRlLCBjaGFubmVsLCBrZXksIGRlY2lkZS52YWx1ZSk7DQogICAgICBpZiAocmVzdWx0ICE9IG51bGwpIHsNCiAgICAgICAgbGV0IHN0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7DQogICAgICAgIHN0YXRlLmRhdGEuY29ubmVjdGlvbi5wdHIuc2VuZChjaGFubmVsLCByZXN1bHQsIHsNCiAgICAgICAgICBmYWlsdXJlOiBmdW5jdGlvbihyZWFzb24pIHsNCg0KICAgICAgICAgIH0sDQogICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24ocGF5bG9hZCkgew0KICAgICAgICAgICAgY29uc29sZS5sb2coIlN1Y2Nlc3N8IiArIHBheWxvYWQuc2VxICsgIjtsYXRlbmN5PSIgKyAocGVyZm9ybWFuY2Uubm93KCkgLSBzdGFydCkpOw0KICAgICAgICAgIH0NCiAgICAgICAgfSk7DQogICAgICB9ICAgICAgDQogICAgfSk7DQogICAgc3Vic2NyaWJlKHN0YXRlLCBuYW1lLCBmdW5jdGlvbih2YWx1ZSkgeyBkZWNpZGUudmFsdWUgPSB2YWx1ZTsgfSk7DQogIH07DQoNCiAgLy8gUlVOVElNRTogPHRhZyAuLiByeDpldmVudD0iLi4uIHNldDpuYW1lPXZhbHVlIC4uLiI+DQogIHNlbGYub25TID0gZnVuY3Rpb24oZG9tLCB0eXBlLCBzdGF0ZSwgbmFtZSwgdmFsdWUpIHsNCiAgICB2YXIgcnVubmFibGUgPSBmdW5jdGlvbigpIHsNCiAgICAgIHZhciBvYmogPSB7fTsNCiAgICAgIGlmICh0eXBlb2YodmFsdWUpID09ICdmdW5jdGlvbicpIHsNCiAgICAgICAgb2JqW25hbWVdID0gdmFsdWUoKTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIG9ialtuYW1lXSA9IHZhbHVlOw0KICAgICAgfQ0KICAgICAgdmFyIGRlbHRhID0gcGF0aF90byhzdGF0ZSwgb2JqKTsNCiAgICAgIHN0YXRlW3N0YXRlLmN1cnJlbnRdLnRyZWUudXBkYXRlKGRlbHRhKTsNCiAgICB9Ow0KICAgIGlmICh0eXBlID09ICdsb2FkJykgew0KICAgICAgd2luZG93LnNldFRpbWVvdXQocnVubmFibGUsIDEpOw0KICAgIH0gZWxzZSB7DQogICAgICBkb20uYWRkRXZlbnRMaXN0ZW5lcih0eXBlLCBydW5uYWJsZSk7DQogICAgfQ0KICB9Ow0KDQogIC8vIFJVTlRJTUU6IDx0YWcgLi4gcng6ZXZlbnQ9Ii4uLiB0b2dnbGU6bmFtZSAuLi4iPg0KICBzZWxmLm9uVCA9IGZ1bmN0aW9uKGRvbSwgdHlwZSwgc3RhdGUsIG5hbWUpIHsNCiAgICB2YXIgY2FwdHVyZWQgPSB7dmFsdWU6IGZhbHNlfTsNCiAgICBkb20uYWRkRXZlbnRMaXN0ZW5lcih0eXBlLCBmdW5jdGlvbigpIHsNCiAgICAgIHZhciBvYmogPSB7fTsNCiAgICAgIG9ialtuYW1lXSA9ICFjYXB0dXJlZC52YWx1ZTsNCiAgICAgIHZhciBkZWx0YSA9IHBhdGhfdG8oc3RhdGUsIG9iaik7DQogICAgICBzdGF0ZVtzdGF0ZS5jdXJyZW50XS50cmVlLnVwZGF0ZShkZWx0YSk7DQogICAgfSk7DQogICAgc3Vic2NyaWJlKHN0YXRlLCBuYW1lLCBmdW5jdGlvbih2YWx1ZSkgew0KICAgICAgY2FwdHVyZWQudmFsdWUgPSB2YWx1ZSA9PSB0cnVlOw0KICAgIH0pOw0KICB9Ow0KDQogIC8vIFJVTlRJTUU6IDx0YWcgLi4gcng6ZXZlbnQ9Ii4uLiBkZWx0YTpuYW1lPWRpZmYiIC4uLiI+DQogIHNlbGYub25EID0gZnVuY3Rpb24oZG9tLCB0eXBlLCBzdGF0ZSwgbmFtZSwgZGlmZikgew0KICAgIHZhciBjYXB0dXJlZCA9IHt2YWx1ZTogMH07DQogICAgZG9tLmFkZEV2ZW50TGlzdGVuZXIodHlwZSwgZnVuY3Rpb24oKSB7DQogICAgICB2YXIgb2JqID0ge307DQogICAgICBvYmpbbmFtZV0gPSBjYXB0dXJlZC52YWx1ZSArIGRpZmY7DQogICAgICB2YXIgZGVsdGEgPSBwYXRoX3RvKHN0YXRlLCBvYmopOw0KICAgICAgc3RhdGVbc3RhdGUuY3VycmVudF0udHJlZS51cGRhdGUoZGVsdGEpOw0KICAgIH0pOw0KICAgIHN1YnNjcmliZShzdGF0ZSwgbmFtZSwgZnVuY3Rpb24odmFsdWUpIHsNCiAgICAgIGlmICh0eXBlb2YodmFsdWUpID09ICJudW1iZXIiKSB7DQogICAgICAgIGNhcHR1cmVkLnZhbHVlID0gdmFsdWU7DQogICAgICB9IGVsc2Ugew0KICAgICAgICB2YXIgdmFsID0gcGFyc2VGbG9hdCh2YWx1ZSk7DQogICAgICAgIGlmICghaXNOYU4odmFsKSkgew0KICAgICAgICAgIGNhcHR1cmVkLnZhbHVlID0gdmFsOw0KICAgICAgICB9DQogICAgICB9DQogICAgfSk7DQogIH07DQoNCiAgc2VsZi5ERSA9IGZ1bmN0aW9uKHBhcmVudCwgcHJpb3JTdGF0ZSwgZXZhbFN0YXRlLCBjaGFubmVsLCBrZXksIG5hbWUsIHNob3VsZEJlLCBfZXhwYW5kLCBtYWtlclRydWUsIG1ha2VyRmFsc2UpIHsNCiAgICB2YXIgZGVjaWRlID0gew0KICAgICAgdmFsdWU6ICcnLA0KICAgICAgb3duZXI6IHBhcmVudCwNCiAgICAgIHNob3duOiBmYWxzZSwNCiAgICAgIGV2YWw6IG51bGwsDQogICAgfTsNCiAgICBhZGRfdW5zdWIoZGVjaWRlKTsNCiAgICB2YXIgY2hhbmdlID0gZnVuY3Rpb24oc2hvdykgew0KICAgICAgZmlyZV91bnN1YihkZWNpZGUpOw0KICAgICAgbnVrZShwYXJlbnQpOw0KICAgICAgdmFyIHN0YXRlID0gZm9yayhwcmlvclN0YXRlKTsNCiAgICAgIGlmIChzaG93ID09PSBzaG91bGRCZSkgew0KICAgICAgICBtYWtlclRydWUocGFyZW50LCBzdGF0ZSk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBtYWtlckZhbHNlKHBhcmVudCwgc3RhdGUpOw0KICAgICAgfQ0KICAgICAgc3Vic2NyaWJlX3N0YXRlKHN0YXRlLCBkZWNpZGUpOw0KICAgIH07DQoNCiAgICBkZWNpZGUudXBkYXRlID0gZnVuY3Rpb24oKSB7DQogICAgICB2YXIgZXZhbCA9IGZpbmQocHJpb3JTdGF0ZSwgY2hhbm5lbCwga2V5LCBkZWNpZGUudmFsdWUpICE9IG51bGw7DQogICAgICBpZiAoZGVjaWRlLmV2YWwgIT0gZXZhbCkgew0KICAgICAgICBkZWNpZGUuZXZhbCA9IGV2YWw7DQogICAgICAgIGNoYW5nZShkZWNpZGUuZXZhbCk7DQogICAgICB9DQogICAgfTsNCg0KICAgIHByaW9yU3RhdGUuZGF0YS5jb25uZWN0aW9uLnN1YnNjcmliZShjaGFubmVsLCBmdW5jdGlvbigpIHsNCiAgICAgIGRlY2lkZS51cGRhdGUoKTsNCiAgICB9KTsNCg0KICAgIHN1YnNjcmliZShldmFsU3RhdGUsIG5hbWUsIGZ1bmN0aW9uKHZhbHVlKSB7DQogICAgICBkZWNpZGUudmFsdWUgPSB2YWx1ZTsNCiAgICAgIGRlY2lkZS51cGRhdGUoKTsNCiAgICB9KTsNCiAgfTsNCg0KICBzZWxmLklGID0gZnVuY3Rpb24ocGFyZW50LCBwcmlvclN0YXRlLCBuYW1lLCBzaG91bGRCZSwgZXhwYW5kVmlldywgbWFrZXJUcnVlLCBtYWtlckZhbHNlKSB7DQogICAgdmFyIHVuc3ViID0gbWFrZV91bnN1YigpOw0KICAgIHZhciBzZXQgPSBmdW5jdGlvbih2YWx1ZSkgew0KICAgICAgdmFyIHNob3cgPSAodmFsdWUgPyB0cnVlIDogZmFsc2UpID09PSBzaG91bGRCZTsNCiAgICAgIGlmICh0aGlzLnNob3duID09IHNob3cpIHsNCiAgICAgICAgcmV0dXJuOw0KICAgICAgfQ0KICAgICAgdGhpcy5zaG93biA9IHNob3c7DQogICAgICBudWtlKHBhcmVudCk7DQogICAgICBmaXJlX3Vuc3ViKHVuc3ViKTsNCiAgICAgIHZhciBzdGF0ZSA9IGZvcmsocHJpb3JTdGF0ZSk7DQogICAgICB2YXIgbmV4dCA9IHN0YXRlOw0KICAgICAgaWYgKHR5cGVvZih2YWx1ZSkgPT0gJ29iamVjdCcpIHsNCiAgICAgICAgbmV4dCA9IHNlbGYucEkobmV4dCwgbmFtZSk7DQogICAgICAgIGlmIChleHBhbmRWaWV3KSB7DQogICAgICAgICAgbmV4dCA9IHNlbGYucEVWKG5leHQsIG5hbWUpOw0KICAgICAgICB9DQogICAgICB9DQogICAgICBpZiAoc2hvdykgew0KICAgICAgICBtYWtlclRydWUocGFyZW50LCBuZXh0KTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIG1ha2VyRmFsc2UocGFyZW50LCBuZXh0KTsNCiAgICAgIH0NCiAgICAgIHN1YnNjcmliZV9zdGF0ZShzdGF0ZSwgdW5zdWIpOw0KICAgIH0uYmluZCh7c2hvd246c2hvdWxkQmV9KTsNCiAgICBzZXQoIXNob3VsZEJlKTsNCiAgICBzdWJzY3JpYmUocHJpb3JTdGF0ZSwgbmFtZSwgc2V0KTsNCiAgfTsNCg0KICAvLy8gUlVOVElNRSB8IHJ4OmFjdGlvbj1jb3B5OnBhdGgNCiAgc2VsZi5hQ1AgPSBmdW5jdGlvbihmb3JtLCBzdGF0ZSwgbmFtZSkgew0KICAgIGZvcm0ub25zdWJtaXQgPSBmdW5jdGlvbihldnQpIHsNCiAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgdmFyIG9iaiA9IGdldF9mb3JtKGZvcm0pOw0KICAgICAgaWYgKG5hbWUgIT0gIi4iICYmIG5hbWUgIT0gIiIpIHsNCiAgICAgICAgdmFyIG5vID0ge307DQogICAgICAgIG5vW25hbWVdID0gb2JqOw0KICAgICAgICBvYmogPSBubzsNCiAgICAgIH0NCiAgICAgIHZhciBkZWx0YSA9IHBhdGhfdG8oc3RhdGUsIG9iaik7DQogICAgICBzdGF0ZS52aWV3LnRyZWUudXBkYXRlKGRlbHRhKTsNCiAgICB9Ow0KICB9Ow0KICAgIA0KICAvLyBSVU5USU1FIHwgPGlucHV0IC4uLiByeDpzeW5jPXBhdGggLi4uPg0KICBzZWxmLlNZID0gZnVuY3Rpb24oZWwsIHN0YXRlLCBuYW1lLCBtcykgew0KICAgIHZhciB0eXBlID0gKCd0eXBlJyBpbiBlbCkgPyBlbC50eXBlLnRvVXBwZXJDYXNlKCkgOiAndGV4dCc7DQogICAgdmFyIHNpZ25hbCA9IGZ1bmN0aW9uKHZhbHVlKSB7DQogICAgICB2YXIgb2JqID0ge307DQogICAgICBvYmpbbmFtZV0gPSBlbC52YWx1ZTsNCiAgICAgIHZhciBkZWx0YSA9IHBhdGhfdG8oc3RhdGUsIG9iaik7DQogICAgICBzdGF0ZS52aWV3LnRyZWUudXBkYXRlKGRlbHRhKTsNCiAgICB9Ow0KICAgIGlmICh0eXBlID09ICJDSEVDS0JPWCIpIHsNCiAgICAgIGVsLm9uY2hhbmdlID0gZGVib3VuY2UobXMsIGZ1bmN0aW9uKGV2dCkgew0KICAgICAgICBzaWduYWwoZWwuY2hlY2tlZCA/IHRydWUgOiBmYWxzZSk7DQogICAgICB9KTsNCiAgICB9IGVsc2UgaWYgKHR5cGUgPT0gIlJBRElPIikgew0KICAgICAgZWwub25jaGFuZ2UgPSBkZWJvdW5jZShtcywgZnVuY3Rpb24oZXZ0KSB7DQogICAgICAgIGlmIChlbC5jaGVja2VkKSB7DQogICAgICAgICAgc2lnbmFsKGVsLnZhbHVlKTsNCiAgICAgICAgfQ0KICAgICAgfSk7DQogICAgfSBlbHNlIHsNCiAgICAgIGVsLm9uY2hhbmdlID0gZGVib3VuY2UobXMsIGZ1bmN0aW9uKGV2dCkgew0KICAgICAgICBzaWduYWwoZWwudmFsdWUpOw0KICAgICAgfSk7DQogICAgICBlbC5vbmtleXVwID0gZWwub25jaGFuZ2U7DQogICAgICB3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbigpIHsNCiAgICAgICAgc2lnbmFsKGVsLnZhbHVlKTsNCiAgICAgIH0sIDEpOw0KICAgIH0NCiAgfTsNCg0KICAvLyBIRUxQRVIgfCBleHRyYWN0IGFsbCB0aGUgaW5wdXRzIGZyb20gdGhlIGdpdmVuIGVsZW1lbnQgYW5kIGJ1aWxkIGFuIG9iamVjdA0KICB2YXIgYnVpbGRfb2JqID0gZnVuY3Rpb24oZWwsIG9iaikgew0KICAgIGlmIChlbC50YWdOYW1lLnRvVXBwZXJDYXNlKCkgPT0gIlRFWFRBUkVBIikgew0KICAgICAgb2JqW2VsLm5hbWVdID0gZWwudmFsdWU7DQogICAgfSBlbHNlIGlmIChlbC50YWdOYW1lLnRvVXBwZXJDYXNlKCkgPT0gIlNFTEVDVCIpIHsNCiAgICAgIG9ialtlbC5uYW1lXSA9IGVsLnZhbHVlOw0KICAgIH0gZWxzZSBpZiAoZWwudGFnTmFtZS50b1VwcGVyQ2FzZSgpID09ICJJTlBVVCIpIHsNCiAgICAgIHZhciB0eXBlID0gKCd0eXBlJyBpbiBlbCkgPyBlbC50eXBlLnRvVXBwZXJDYXNlKCkgOiAndGV4dCc7DQogICAgICBpZiAodHlwZSA9PSAiU1VCTUlUIiB8fCB0eXBlID09ICJSRVNFVCIpIHJldHVybjsNCiAgICAgIGlmICgnbmFtZScgaW4gZWwpIHsNCiAgICAgICAgdmFyIG5hbWUgPSBlbC5uYW1lOw0KICAgICAgICB2YXIgaW5zZXJ0QXQgPSBvYmo7DQogICAgICAgIHZhciBwdXNoID0gbmFtZS5lbmRzV2l0aCgiW10iKTsNCiAgICAgICAgaWYgKHB1c2gpIHsNCiAgICAgICAgICBuYW1lID0gbmFtZS5zdWJzdHIoMCwgbmFtZS5sZW5ndGggLSAyKTsNCiAgICAgICAgICBpZiAobmFtZSBpbiBpbnNlcnRBdCkgew0KICAgICAgICAgICAgaW5zZXJ0QXRbbmFtZV0gPSBbXTsNCiAgICAgICAgICB9DQogICAgICAgICAgaW5zZXJ0QXQgPSBpbnNlcnRBdFtuYW1lXTsNCiAgICAgICAgICBpZiAodHlwZSA9PSAiQ0hFQ0tCT1giKSB7DQogICAgICAgICAgICBpbnNlcnRBdC5wdXNoKGVsLmNoZWNrZWQgPyB0cnVlIDogZmFsc2UpOw0KICAgICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PSAiUkFESU8iKSB7DQogICAgICAgICAgICBpZiAoZWwuY2hlY2tlZCkgew0KICAgICAgICAgICAgICBpbnNlcnRBdC5wdXNoKGVsLnZhbHVlKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgaW5zZXJ0QXQucHVzaChlbC52YWx1ZSk7DQogICAgICAgICAgfQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIGlmICh0eXBlID09ICJDSEVDS0JPWCIpIHsNCiAgICAgICAgICAgIGluc2VydEF0W25hbWVdID0gZWwuY2hlY2tlZCA/IHRydWUgOiBmYWxzZTsNCiAgICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT0gIlJBRElPIikgew0KICAgICAgICAgICAgaWYgKGVsLmNoZWNrZWQpIHsNCiAgICAgICAgICAgICAgaW5zZXJ0QXRbbmFtZV0gPSBlbC52YWx1ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgaW5zZXJ0QXRbbmFtZV0gPSBlbC52YWx1ZTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9IGVsc2Ugew0KICAgICAgaWYgKCdjaGlsZHJlbicgaW4gZWwpIHsNCiAgICAgICAgdmFyIGFyciA9IGVsLmNoaWxkcmVuOw0KICAgICAgICB2YXIgbiA9IGFyci5sZW5ndGg7DQogICAgICAgIGZvciAodmFyIGsgPSAwOyBrIDwgbjsgaysrKSB7DQogICAgICAgICAgdmFyIGNoID0gZWwuY2hpbGRyZW5ba107DQogICAgICAgICAgYnVpbGRfb2JqKGNoLCBvYmopOw0KICAgICAgICB9DQogICAgICB9DQogICAgfQ0KICB9Ow0KDQogIC8vIEhFTFBFUiB8IHJldHVybiBhbiBvYmplY3Qgb2YgYWxsIHRoZSBpbnB1dHMgb2YgdGhlIGdpdmVuIGZvcm0gZWxlbWVudA0KICB2YXIgZ2V0X2Zvcm0gPSBmdW5jdGlvbihmb3JtKSB7DQogICAgdmFyIG9iaiA9IHt9Ow0KICAgIGJ1aWxkX29iaihmb3JtLCBvYmopOw0KICAgIHJldHVybiBvYmo7DQogIH07DQoNCiAgLy8gSEVMUEVSIHwgY3JlYXRlIGEgc2lnbmFsIGZvciB3aGVuIHRoaW5ncyBmYWlsOyB0aGlzIHdpbGwgd3JpdGUgaW50byB0aGUgdGhlIHZpZXcNCiAgdmFyIG1ha2VfZmFpbHVyZV9zaWduYWwgPSBmdW5jdGlvbihzdGF0ZSwgZmFpbHVyZVZhcikgew0KICAgIHJldHVybiBmdW5jdGlvbihmYWlsKSB7DQogICAgICB2YXIgb2JqID0ge307DQogICAgICBvYmpbZmFpbHVyZVZhcl0gPSBmYWlsOw0KICAgICAgdmFyIGRlbHRhID0gcGF0aF90byhzZWxmLnBWKHN0YXRlKSwgb2JqKTsNCiAgICAgIGNvbnNvbGUubG9nKGRlbHRhKTsNCiAgICAgIHN0YXRlLnZpZXcudHJlZS51cGRhdGUoZGVsdGEpOw0KICAgIH07DQogIH07DQoNCiAgLyoqDQogLyQkJCQkJCQkIC8kJCQkJCQgIC8kJCQkJCQkICAgLyQkJCQkJCANCnxfXyAgJCRfXy8vJCRfXyAgJCR8ICQkX18gICQkIC8kJF9fICAkJA0KICAgfCAkJCAgfCAkJCAgXCAkJHwgJCQgIFwgJCR8ICQkICBcICQkDQogICB8ICQkICB8ICQkICB8ICQkfCAkJCAgfCAkJHwgJCQgIHwgJCQNCiAgIHwgJCQgIHwgJCQgIHwgJCR8ICQkICB8ICQkfCAkJCAgfCAkJA0KICAgfCAkJCAgfCAkJCAgfCAkJHwgJCQgIHwgJCR8ICQkICB8ICQkDQogICB8ICQkICB8ICAkJCQkJCQvfCAkJCQkJCQkL3wgICQkJCQkJC8NCiAgIHxfXy8gICBcX19fX19fLyB8X19fX19fXy8gIFxfX19fX18vIA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKi8NCiAgDQogIC8vIFJVTlRJTUUgfCByZWdpc3RlciB0aGUgcGFnZSBmb3IgdGhlIHVyaSB0byB0aGUgZ2l2ZW4gZm9vKCkuDQogIHNlbGYuUEcgPSBmdW5jdGlvbih1cmksIGZvbykgew0KICAgIHZhciBoZWFkID0gcm91dGVyOw0KICAgIGZvciAodmFyIGsgPSAwOyBrIDwgdXJpLmxlbmd0aDsgaysrKSB7DQogICAgICB2YXIgcGFydCA9IHVyaVtrXTsNCiAgICAgIGlmICghKHBhcnQgaW4gaGVhZCkpIHsNCiAgICAgICAgaGVhZFtwYXJ0XSA9IHt9Ow0KICAgICAgfQ0KICAgICAgaGVhZCA9IGhlYWRbcGFydF07DQogICAgfQ0KICAgIGhlYWRbJ0AnXSA9IGZvbzsNCiAgfTsNCg0KICB2YXIgcm91dGUgPSBmdW5jdGlvbihwYXJ0cywgYXQsIGhlYWQsIHZpZXcpIHsNCiAgICBpZiAoYXQgPCBwYXJ0cy5sZW5ndGgpIHsNCiAgICAgIGlmICgnbnVtYmVyJyBpbiBoZWFkKSB7DQogICAgICAgIHZhciBuZWNrID0gaGVhZFsnbnVtYmVyJ107DQogICAgICAgIHZhciB2YWwgPSBwYXJzZUZsb2F0KHBhcnRzW2F0XSk7DQogICAgICAgIGlmICghaXNOYU4odmFsKSkgew0KICAgICAgICAgIGZvciAodmFyIGJyYW5jaCBpbiBuZWNrKSB7DQogICAgICAgICAgICB2aWV3W2JyYW5jaF0gPSB2YWw7DQogICAgICAgICAgICB2YXIgY2FuZGlkYXRlID0gcm91dGUocGFydHMsIGF0ICsgMSwgbmVja1ticmFuY2hdLCB2aWV3KTsNCiAgICAgICAgICAgIGlmIChjYW5kaWRhdGUgIT09IG51bGwpIHsNCiAgICAgICAgICAgICAgcmV0dXJuIGNhbmRpZGF0ZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGRlbGV0ZSB2aWV3W2JyYW5jaF07DQogICAgICAgICAgfQ0KICAgICAgICB9Ow0KICAgICAgfQ0KICAgICAgaWYgKCd0ZXh0JyBpbiBoZWFkKSB7DQogICAgICAgIHZhciBuZWNrID0gaGVhZFsndGV4dCddOw0KICAgICAgICB2YXIgdmFsID0gcGFydHNbYXRdOw0KICAgICAgICBmb3IgKHZhciBicmFuY2ggaW4gbmVjaykgew0KICAgICAgICAgIHZpZXdbYnJhbmNoXSA9IHZhbDsNCiAgICAgICAgICB2YXIgY2FuZGlkYXRlID0gcm91dGUocGFydHMsIGF0ICsgMSwgbmVja1ticmFuY2hdLCB2aWV3KTsNCiAgICAgICAgICBpZiAoY2FuZGlkYXRlICE9PSBudWxsKSB7DQogICAgICAgICAgICByZXR1cm4gY2FuZGlkYXRlOw0KICAgICAgICAgIH0NCiAgICAgICAgICBkZWxldGUgdmlld1ticmFuY2hdOw0KICAgICAgICB9DQogICAgICB9DQogICAgICBpZiAoJ2ZpeGVkJyBpbiBoZWFkKSB7DQogICAgICAgIHZhciBuZWNrID0gaGVhZFsnZml4ZWQnXTsNCiAgICAgICAgZm9yICh2YXIgYnJhbmNoIGluIG5lY2spIHsNCiAgICAgICAgICBpZiAoYnJhbmNoID09IHBhcnRzW2F0XSkgew0KICAgICAgICAgICAgdmFyIGNhbmRpZGF0ZSA9IHJvdXRlKHBhcnRzLCBhdCArIDEsIG5lY2tbYnJhbmNoXSwgdmlldyk7DQogICAgICAgICAgICBpZiAoY2FuZGlkYXRlICE9PSBudWxsKSB7DQogICAgICAgICAgICAgIHJldHVybiBjYW5kaWRhdGU7DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICB9DQogICAgfSBlbHNlIHsNCiAgICAgIGlmICgnQCcgaW4gaGVhZCkgew0KICAgICAgICByZXR1cm4gaGVhZFsnQCddOw0KICAgICAgfQ0KICAgIH0NCiAgfTsNCg0KICBzZWxmLmdvdG8gPSBmdW5jdGlvbih2aWV3U3RhdGUsIHVyaSkgew0KICAgIC8vIFRPRE86IGZpZ3VyZSBvdXQgYSBiZXR0ZXIgbW9kZWwuDQogICAgd2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24oKSB7DQogICAgICBpZiAodXJpLnN0YXJ0c1dpdGgoIi8iKSkgew0KICAgICAgICBzZWxmLnJ1bihkb2N1bWVudC5ib2R5LCB1cmksIHRydWUpOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBmaXhIcmVmKHVyaSk7DQogICAgICB9DQogICAgfSwgMTApOw0KICB9Ow0KDQogIHNlbGYuaW5pdCA9IGZ1bmN0aW9uKCkgew0KICAgIHNlbGYucnVuKGRvY3VtZW50LmJvZHksIGZpeFBhdGgod2luZG93LmxvY2F0aW9uLnBhdGhuYW1lICsgd2luZG93LmxvY2F0aW9uLmhhc2gpLCBmYWxzZSk7DQogICAgd2luZG93Lm9ucG9wc3RhdGUgPSBmdW5jdGlvbigpIHsNCiAgICAgIGNvbnNvbGUubG9nKCJwb3BzdGF0ZToiICsgZml4UGF0aCh3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUpKTsNCiAgICAgIHNlbGYucnVuKGRvY3VtZW50LmJvZHksIGZpeFBhdGgod2luZG93LmxvY2F0aW9uLnBhdGhuYW1lICsgd2luZG93LmxvY2F0aW9uLmhhc2gpLCBmYWxzZSk7DQogICAgfTsNCiAgfTsNCg0KICAvLyBBUEkgfCBSdW4gdGhlIHBhZ2UgaW4gdGhlIGdpdmVuIHBsYWNlDQogIHNlbGYucnVuID0gZnVuY3Rpb24od2hlcmUsIHBhdGgsIHB1c2gpIHsNCiAgICBmb3IgKGNvbktleSBpbiBjb25uZWN0aW9ucykgew0KICAgICAgY29ubmVjdGlvbnNbY29uS2V5XS50cmVlLm51a2UoKTsNCiAgICB9DQogICAgdmFyIHBhcnRzID0gKHBhdGguc3RhcnRzV2l0aCgiLyIpID8gcGF0aC5zdWJzdHJpbmcoMSkgOiBwYXRoKS5zcGxpdCgiLyIpOw0KICAgIHZhciBpbml0ID0geydzZXNzaW9uX2lkJzoiUiIgKyBNYXRoLnJhbmRvbSgpfTsNCiAgICB2YXIgZm9vID0gcm91dGUocGFydHMsIDAsIHJvdXRlciwgaW5pdCk7DQogICAgaWYgKGZvbyAhPSBudWxsKSB7DQogICAgICBudWtlKHdoZXJlKTsNCiAgICAgIHZhciBzdGF0ZSA9IHtzZXJ2aWNlOiBjb25uZWN0aW9uLCBkYXRhOm51bGwsIHZpZXc6ZnJlc2god2hlcmUpLCBjdXJyZW50Oid2aWV3J307DQogICAgICBmb28od2hlcmUsIHN0YXRlKTsNCiAgICAgIHN0YXRlLnZpZXcudHJlZS5zdWJzY3JpYmUoc3RhdGUudmlldy5kZWx0YSk7DQogICAgICBzdGF0ZS52aWV3LnRyZWUudXBkYXRlKGluaXQpOw0KICAgICAgaWYgKHB1c2gpIHsNCiAgICAgICAgd2luZG93Lmhpc3RvcnkucHVzaFN0YXRlKHt9LCAnJywgZml4SHJlZihwYXRoKSk7DQogICAgICB9DQogICAgfSBlbHNlIHsNCiAgICAgIGlmIChwYXRoICE9ICIvNDA0Iikgew0KICAgICAgICBzZWxmLnJ1bih3aGVyZSwgIi80MDQiKTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIC8vIGRlZmF1bHQgNDA0DQogICAgICB9DQogICAgfQ0KICB9Ow0KDQogIHZhciBpZGVudGl0aWVzID0ge307DQoNCiAgc2VsZi5TSUdOT1VUID0gZnVuY3Rpb24oKSB7DQogICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oImlkZW50aXR5X2RlZmF1bHQiKTsNCiAgICBzZWxmLmdvdG8obnVsbCwgJy8nKTsNCiAgfTsNCg0KICBzZWxmLkdPT0dMRV9TSUdOX09OID0gZnVuY3Rpb24oYWNjZXNzVG9rZW4pIHsNCiAgICBjb25uZWN0aW9uLkluaXRDb252ZXJ0R29vZ2xlVXNlcihhY2Nlc3NUb2tlbiwgew0KICAgICAgc3VjY2VzczpmdW5jdGlvbihwYXlsb2FkKSB7DQogICAgICAgIGlkZW50aXRpZXNbJ2RlZmF1bHQnXSA9IHBheWxvYWQuaWRlbnRpdHk7DQogICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCJpZGVudGl0eV9kZWZhdWx0IiwgcGF5bG9hZC5pZGVudGl0eSk7DQogICAgICAgIHNlbGYuZ290byhudWxsLCAnLycpOw0KICAgICAgfSwNCiAgICAgIGZhaWx1cmU6IGZ1bmN0aW9uKHJlYXNvbikgew0KICAgICAgICBjb25zb2xlLmxvZygiR29vZ2xlIGZhaWx1cmU6ICIgK3JlYXNvbik7DQogICAgICB9DQogICAgfSk7DQogIH07DQoNCiAgLyoqIGZvciBjdXN0b20gZWxlbWVudHMgdG8gbGVhcm4gb2YgdGhlIGlkZW50aXR5ICovDQogIHNlbGYuSUQgPSBmdW5jdGlvbihpZGVudGl0eU5hbWUsIHJlZGlyZWN0VG8pIHsNCiAgICAgIC8vIElGIGlkZW50aXR5IGNvbnRhaW5zIGRvdHMNCiAgICAgIHZhciBpZGVudGl0eSA9IG51bGw7DQogICAgICB2YXIgY2xlYW51cCA9IGZ1bmN0aW9uKCkge307DQoNCiAgICAgIHZhciB2YWwgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgiaWRlbnRpdHlfIiAraWRlbnRpdHlOYW1lKTsNCiAgICAgIGlmICh2YWwpIHsNCiAgICAgICAgaWRlbnRpdGllc1tpZGVudGl0eU5hbWVdID0gdmFsOw0KICAgICAgfQ0KDQogICAgICBpZiAoaWRlbnRpdHlOYW1lLnN0YXJ0c1dpdGgoImRpcmVjdDoiKSkgew0KICAgICAgICAvLyBVc2UsIGFzIGlzDQogICAgICAgIGlkZW50aXR5ID0gaWRlbnRpdHlOYW1lLnN1YnN0cig3KTsNCiAgICAgIH0gZWxzZSBpZiAoaWRlbnRpdHlOYW1lIGluIGlkZW50aXRpZXMpIHsNCiAgICAgICAgaWRlbnRpdHkgPSBpZGVudGl0aWVzW2lkZW50aXR5TmFtZV07DQogICAgICAgIGNsZWFudXAgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgICBkZWxldGUgaWRlbnRpdGllc1tpZGVudGl0eU5hbWVdOw0KICAgICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCJpZGVudGl0eV8iICsgaWRlbnRpdHlOYW1lKTsNCiAgICAgICAgfTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIC8vIHdoYXRldmVyIHBhZ2Ugd2UgYXJlLCBuZWVkcyB0byBkaWUgd2hpY2ggbWVhbnMgd2UgbmVlZCB0byBudWtlIGV2ZXJ5dGhpbmchDQogICAgICAgIHdpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uKCkgew0KICAgICAgICAgIC8vIFRPRE86IHRoaXMgYXNzdW1lcyBhIGZ1bGwgYXBwIGdvZXMgdG8gdGhlIHdpbmRvdw0KICAgICAgICAgIHNlbGYuZ290byhudWxsLCByZWRpcmVjdFRvKTsNCiAgICAgICAgfSwgMTApOw0KICAgICAgICByZXR1cm4ge2Fib3J0OnRydWV9Ow0KICAgICAgfQ0KDQogICAgICByZXR1cm4ge2Fib3J0OmZhbHNlLCBjbGVhbnVwOmNsZWFudXAsIGlkZW50aXR5OmlkZW50aXR5fTsNCiAgfTsNCg0KICB2YXIgY3VzdG9tRGF0YVNvdXJjZXMgPSB7fTsNCg0KICAvKiogcHJvdmlkZSBjdXN0b20gZGF0YSAqLw0KICBzZWxmLlBSQ1VEQSA9IGZ1bmN0aW9uKG5hbWUsIGZvbykgew0KICAgIGN1c3RvbURhdGFTb3VyY2VzW25hbWVdID0gZm9vOw0KICB9Ow0KDQogIC8vIDxjdXN0b21kYXRhIHNyYz1zcmMgKHBhcmFtZXRlcjp4PXkpKiA+DQogIHNlbGYuQ1VEQSA9IGZ1bmN0aW9uKHBhcmVudCwgcHJpb3JTdGF0ZSwgc3JjLCByeG9iaiwgcmVkaXJlY3RUbywgY2hpbGRNYWtlcikgew0KICAgIHZhciB1bnN1YiA9IG1ha2VfdW5zdWIoKTsNCiAgICByeG9iai5fXyA9IGRlYm91bmNlKDEwLCBmdW5jdGlvbigpIHsNCiAgICAgIGZpcmVfdW5zdWIodW5zdWIpOw0KICAgICAgbnVrZShwYXJlbnQpOw0KICAgICAgdmFyIGN1c3RvbVRyZWUgPSBmYWxzZTsNCiAgICAgIGlmIChzcmMgaW4gY3VzdG9tRGF0YVNvdXJjZXMpIHsNCiAgICAgICAgdmFyIGNvbnMgPSBjdXN0b21EYXRhU291cmNlc1tzcmNdOw0KICAgICAgICBpZiAodHlwZW9mKGNvbnMpPT0nZnVuY3Rpb24nKSB7DQogICAgICAgICAgY3VzdG9tVHJlZSA9IGNvbnMocnhvYmosIHByaW9yU3RhdGUsIHJlZGlyZWN0VG8sIHNlbGYpOw0KICAgICAgICB9DQogICAgICB9DQogICAgICBpZiAoIWN1c3RvbVRyZWUpIHsNCiAgICAgICAgY3VzdG9tVHJlZSA9IG5ldyBBZGFtYVRyZWVTaW1wbGUoKTsNCiAgICAgIH0NCiAgICAgIHZhciBzdGF0ZSA9IHsNCiAgICAgICAgc2VydmljZTogcHJpb3JTdGF0ZS5zZXJ2aWNlLA0KICAgICAgICBkYXRhOiB7Y29ubmVjdGlvbjogcHJpb3JTdGF0ZS5jb25uZWN0aW9uLCB0cmVlOmN1c3RvbVRyZWUsIGRlbHRhOnt9LCBwYXJlbnQ6bnVsbCwgcGF0aDpudWxsfSwNCiAgICAgICAgdmlldzogbmV3X2RlbHRhX2NvcHkocHJpb3JTdGF0ZS52aWV3KSwNCiAgICAgICAgY3VycmVudDonZGF0YScNCiAgICAgIH07DQogICAgICBjaGlsZE1ha2VyKHN0YXRlKTsNCiAgICAgIHN1YnNjcmliZV9zdGF0ZShzdGF0ZSwgdW5zdWIpOw0KICAgIH0pOw0KICB9Ow0KDQogIC8vIDxjb25uZWN0aW9uIC4uLj4NCiAgc2VsZi5DT05ORUNUID0gZnVuY3Rpb24oc3RhdGUsIHJ4b2JqLCBpZGVudGl0eU5hbWUsIHJlZGlyZWN0VG8pIHsNCiAgICB2YXIgdW5zdWIgPSB7dmlldzpmdW5jdGlvbigpe319Ow0KICAgIHJ4b2JqLl9fID0gZGVib3VuY2UoMTAsIGZ1bmN0aW9uKCkgew0KICAgICAgdmFyIGNvID0gZ2V0X2Nvbm5lY3Rpb25fb2JqKHJ4b2JqLm5hbWUpOw0KICAgICAgdmFyIGRlc2lyZWQgPSByeG9iai5zcGFjZSArICIvIiArIHJ4b2JqLmtleTsNCg0KICAgICAgdmFyIGJpbmQgPSBmdW5jdGlvbihzZW5kTm93KSB7DQogICAgICAgIHVuc3ViLnZpZXcgPSBzdGF0ZS52aWV3LnRyZWUuc3Vic2NyaWJlKGZ1bmN0aW9uKCkgew0KICAgICAgICAgIGlmIChjby5wdHIgPT0gbnVsbCkgew0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgIH0NCiAgICAgICAgICBjby5wdHIudXBkYXRlKHN0YXRlLnZpZXcudHJlZS5jb3B5KCksIHsNCiAgICAgICAgICAgIHN1Y2Nlc3M6ZnVuY3Rpb24oKSB7fSwNCiAgICAgICAgICAgIGZhaWx1cmU6IGZ1bmN0aW9uKCkge30NCiAgICAgICAgICB9KTsNCiAgICAgICAgfSk7DQogICAgICAgIGlmIChzZW5kTm93KSB7DQogICAgICAgICAgY29uc29sZS5sb2coc3RhdGUudmlldy50cmVlLnN0cigpKTsNCiAgICAgICAgICBjby5wdHIudXBkYXRlKHN0YXRlLnZpZXcudHJlZS5jb3B5KCksIHsNCiAgICAgICAgICAgIHN1Y2Nlc3M6ZnVuY3Rpb24oKSB7fSwNCiAgICAgICAgICAgIGZhaWx1cmU6IGZ1bmN0aW9uKCkge30NCiAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KICAgICAgfTsNCg0KICAgICAgaWYgKGNvLnB0ciAhPSBudWxsICYmIGNvLmJvdW5kID09IGRlc2lyZWQpIHsNCiAgICAgICAgYmluZCh0cnVlKTsNCiAgICAgICAgcmV0dXJuOw0KICAgICAgfQ0KICAgICAgaWYgKGNvLnB0ciAhPSBudWxsKSB7DQogICAgICAgIGNvLnB0ci5lbmQoKTsNCiAgICAgIH0NCg0KICAgICAgdmFyIGlkTG9va3VwID0gc2VsZi5JRChpZGVudGl0eU5hbWUsIHJlZGlyZWN0VG8pOw0KICAgICAgaWYgKGlkTG9va3VwLmFib3J0KSB7DQogICAgICAgIHJldHVybjsNCiAgICAgIH0NCiAgICAgIHZhciBpZGVudGl0eSA9IGlkTG9va3VwLmlkZW50aXR5Ow0KICAgICAgdmFyIGNsZWFudXAgPSBpZExvb2t1cC5jbGVhbnVwOw0KICAgICAgY28uYm91bmQgPSBkZXNpcmVkOw0KDQogICAgICB1bnN1Yi52aWV3KCk7DQogICAgICB2YXIgdncgPSBzdGF0ZS52aWV3LnRyZWUuY29weSgpOw0KICAgICAgY28uc3BhY2UgPSByeG9iai5zcGFjZTsNCiAgICAgIGNvLmtleSA9IHJ4b2JqLmtleTsNCiAgICAgIGNvLnB0ciA9IGNvbm5lY3Rpb24uQ29ubmVjdGlvbkNyZWF0ZShpZGVudGl0eSwgcnhvYmouc3BhY2UsIHJ4b2JqLmtleSwgdncsIHsNCiAgICAgICAgbmV4dDogZnVuY3Rpb24ocGF5bG9hZCkgew0KICAgICAgICAgIGlmICgnZGF0YScgaW4gcGF5bG9hZC5kZWx0YSkgew0KICAgICAgICAgICAgY28udHJlZS51cGRhdGUocGF5bG9hZC5kZWx0YS5kYXRhKTsNCiAgICAgICAgICB9DQogICAgICAgICAgaWYgKCdvdXRzdGFuZGluZycgaW4gcGF5bG9hZC5kZWx0YSkgew0KICAgICAgICAgICAgY28ub25kZWNpZGUocGF5bG9hZC5kZWx0YS5vdXRzdGFuZGluZyk7DQogICAgICAgICAgfQ0KICAgICAgICB9LA0KICAgICAgICBmYWlsdXJlOiBmdW5jdGlvbihyZWFzb24pIHsNCiAgICAgICAgICAvLyBUT0RPOiBpZiBub3QgYXV0aG9yaXplZA0KICAgICAgICAgIC8qDQogICAgICAgICAgaWYgKGZhbHNlKSB7DQogICAgICAgICAgICBjbGVhbnVwKCk7DQogICAgICAgICAgfQ0KICAgICAgICAgICovDQogICAgICAgICAgY28ucHRyID0gbnVsbDsNCiAgICAgICAgICAvLyBUT0RPOiBzY2hlZHVsZSBhIHJldHJ5PyBpbnZva2U6ICByeG9iai5fXygpOw0KICAgICAgICB9LA0KICAgICAgfSk7DQogICAgICBiaW5kKGZhbHNlKTsNCiAgICB9KTsNCiAgfTsNCiAgDQogIHNlbGYuSU5URVJOQUwgPSBmdW5jdGlvbihwcmlvclN0YXRlKSB7DQogICAgcmV0dXJuIHsNCiAgICAgIHNlcnZpY2U6IHByaW9yU3RhdGUuc2VydmljZSwNCiAgICAgIGRhdGE6IHtjb25uZWN0aW9uOiBudWxsLCB0cmVlOm5ldyBBZGFtYVRyZWVTaW1wbGUoKSwgZGVsdGE6e30sIHBhcmVudDpudWxsLCBwYXRoOm51bGx9LA0KICAgICAgdmlldzogbmV3X2RlbHRhX2NvcHkocHJpb3JTdGF0ZS52aWV3KSwNCiAgICAgIGN1cnJlbnQ6J2RhdGEnDQogICAgfTsNCiAgfTsNCg0KICB2YXIgcmVjYWxsX2VtYWlsID0gZnVuY3Rpb24oZWwpIHsNCiAgICBpZiAoZWwudGFnTmFtZS50b1VwcGVyQ2FzZSgpID09ICJJTlBVVCIpIHsNCiAgICAgIGlmICgiZW1haWwiID09IGVsLnR5cGUgJiYgImVtYWlsIiA9PSBlbC5uYW1lKSB7DQogICAgICAgIGVsLnZhbHVlID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oImVtYWlsX3JlbWVtYmVyIik7DQogICAgICB9DQogICAgfSBlbHNlIHsNCiAgICAgIGlmICgnY2hpbGRyZW4nIGluIGVsKSB7DQogICAgICAgIHZhciBhcnIgPSBlbC5jaGlsZHJlbjsNCiAgICAgICAgdmFyIG4gPSBhcnIubGVuZ3RoOw0KICAgICAgICBmb3IgKHZhciBrID0gMDsgayA8IG47IGsrKykgew0KICAgICAgICAgIHJlY2FsbF9lbWFpbChlbC5jaGlsZHJlbltrXSk7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9DQogIH07DQoNCiAgLy8gUlVOVElNRSB8IHJ4OmFjdGlvbj1hZGFtYTpzaWduLWluDQogIHNlbGYuYVNPID0gZnVuY3Rpb24oZm9ybSwgc3RhdGUsIGlkZW50aXR5TmFtZSwgZmFpbHVyZVZhciwgZm9yd2FyZFRvKSB7DQogICAgdmFyIHNpZ25hbCA9IG1ha2VfZmFpbHVyZV9zaWduYWwoc3RhdGUsIGZhaWx1cmVWYXIpOw0KICAgIHdpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uKCkgew0KICAgICAgcmVjYWxsX2VtYWlsKGZvcm0pOw0KICAgIH0sIDEpOw0KICAgIGZvcm0ub25zdWJtaXQgPSBmdW5jdGlvbihldnQpIHsNCiAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgdmFyIHJlcSA9IGdldF9mb3JtKGZvcm0pOw0KICAgICAgaWYgKHJlcS5yZW1lbWJlcikgew0KICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgiZW1haWxfcmVtZW1iZXIiLCByZXEuZW1haWwpOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oImVtYWlsX3JlbWVtYmVyIiwgIiIpOw0KICAgICAgfQ0KICAgICAgY29ubmVjdGlvbi5BY2NvdW50TG9naW4ocmVxLmVtYWlsLCByZXEucGFzc3dvcmQsIHsNCiAgICAgICAgc3VjY2VzczogZnVuY3Rpb24ocGF5bG9hZCkgew0KICAgICAgICAgIHNpZ25hbChmYWxzZSk7DQogICAgICAgICAgaWRlbnRpdGllc1tpZGVudGl0eU5hbWVdID0gcGF5bG9hZC5pZGVudGl0eTsNCiAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgiaWRlbnRpdHlfIiArIGlkZW50aXR5TmFtZSwgcGF5bG9hZC5pZGVudGl0eSk7DQogICAgICAgICAgc2VsZi5nb3RvKHN0YXRlLnZpZXcsIGZvcndhcmRUbyk7DQogICAgICAgIH0sDQogICAgICAgIGZhaWx1cmU6IGZ1bmN0aW9uKGNvZGUpIHsNCiAgICAgICAgICBzaWduYWwodHJ1ZSk7DQogICAgICAgICAgLy8gVE9ETzogc29ydCBvdXQgY29uc29sZSBsb2dnaW5nDQogICAgICAgICAgY29uc29sZS5sb2coIkZBSUxVUkU6IiArIGNvZGUpOw0KICAgICAgICB9DQogICAgICB9KTsNCiAgICB9Ow0KICB9Ow0KDQogIC8vIFJVTlRJTUUgfCByeDphY3Rpb249YWRhbWE6c2lnbi11cA0KICBzZWxmLmFTVSA9IGZ1bmN0aW9uKGZvcm0sIHN0YXRlLCBmYWlsdXJlVmFyLCBmb3J3YXJkVG8pIHsNCiAgICB2YXIgc2lnbmFsID0gbWFrZV9mYWlsdXJlX3NpZ25hbChzdGF0ZSwgZmFpbHVyZVZhcik7DQogICAgZm9ybS5vbnN1Ym1pdCA9IGZ1bmN0aW9uKGV2dCkgew0KICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7DQogICAgICB2YXIgcmVxID0gZ2V0X2Zvcm0oZm9ybSk7DQogICAgICBjb25uZWN0aW9uLkluaXRTZXR1cEFjY291bnQocmVxLmVtYWlsLCB7DQogICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKHBheWxvYWQpIHsNCiAgICAgICAgICBzaWduYWwoZmFsc2UpOw0KICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCJlbWFpbCIsIHJlcS5lbWFpbCk7DQogICAgICAgICAgc2VsZi5nb3RvKHN0YXRlLnZpZXcsIGZvcndhcmRUbyk7DQogICAgICAgIH0sDQogICAgICAgIGZhaWx1cmU6IGZ1bmN0aW9uKGNvZGUpIHsNCiAgICAgICAgICBzaWduYWwodHJ1ZSk7DQogICAgICAgICAgY29uc29sZS5sb2coIkZBSUxVUkU6Iik7DQogICAgICAgIH0NCiAgICAgIH0pOw0KICAgIH07DQogIH07DQoNCiAgLy8gUlVOVElNRSB8IHJ4OmFjdGlvbj1hZGFtYTpzZXQtcGFzc3dvcmQNCiAgc2VsZi5hU1AgPSBmdW5jdGlvbihmb3JtLCBzdGF0ZSwgZmFpbHVyZVZhciwgZm9yd2FyZFRvKSB7DQogICAgdmFyIHNpZ25hbCA9IG1ha2VfZmFpbHVyZV9zaWduYWwoc3RhdGUsIGZhaWx1cmVWYXIpOw0KICAgIGZvcm0ub25zdWJtaXQgPSBmdW5jdGlvbihldnQpIHsNCiAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgdmFyIHJlcSA9IGdldF9mb3JtKGZvcm0pOw0KICAgICAgaWYgKCEoJ2VtYWlsJyBpbiByZXEpKSB7DQogICAgICAgIHJlcS5lbWFpbCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdlbWFpbCcpOw0KICAgICAgfQ0KICAgICAgY29ubmVjdGlvbi5Jbml0Q29tcGxldGVBY2NvdW50KHJlcS5lbWFpbCwgZmFsc2UsIHJlcS5jb2RlLCB7DQogICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKGluaXQpIHsNCiAgICAgICAgICBjb25zb2xlLmxvZyhpbml0KTsNCiAgICAgICAgICB2YXIgaWRlbnRpdHkgPSBpbml0LmlkZW50aXR5Ow0KICAgICAgICAgIGNvbm5lY3Rpb24uQWNjb3VudFNldFBhc3N3b3JkKGluaXQuaWRlbnRpdHksIHJlcS5wYXNzd29yZCwgew0KICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgIHNpZ25hbChmYWxzZSk7DQogICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCJpZGVudGl0eV9kZWZhdWx0IiwgaWRlbnRpdHkpOw0KICAgICAgICAgICAgICBzZWxmLmdvdG8oc3RhdGUudmlldywgZm9yd2FyZFRvKTsNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICBmYWlsdXJlOiBmdW5jdGlvbihyZWFzb24pIHsNCiAgICAgICAgICAgICAgc2lnbmFsKHRydWUpOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgIH0pOw0KDQogICAgICAgIH0sDQogICAgICAgIGZhaWx1cmU6IGZ1bmN0aW9uKHJlYXNvbikgew0KICAgICAgICAgIHNpZ25hbCh0cnVlKTsNCiAgICAgICAgfQ0KICAgICAgfSk7DQogICAgfTsNCiAgfTsNCiAgDQogIC8vIFJVTlRJTUUgfCByeDphY3Rpb249c2VuZDokY2hhbm5lbA0KICBzZWxmLmFTRCA9IGZ1bmN0aW9uKGZvcm0sIHN0YXRlLCBjaGFubmVsLCBmYWlsdXJlVmFyKSB7DQogICAgdmFyIHNpZ25hbCA9IG1ha2VfZmFpbHVyZV9zaWduYWwoc3RhdGUsIGZhaWx1cmVWYXIpOw0KICAgIGZvcm0ub25zdWJtaXQgPSBmdW5jdGlvbihldnQpIHsNCiAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdCgpOw0KICAgICAgdmFyIHN0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7DQogICAgICBzdGF0ZS5kYXRhLmNvbm5lY3Rpb24ucHRyLnNlbmQoY2hhbm5lbCwgZ2V0X2Zvcm0oZm9ybSksIHsNCiAgICAgICAgc3VjY2VzczogZnVuY3Rpb24ocGF5bG9hZCkgew0KICAgICAgICAgIHNpZ25hbChmYWxzZSk7DQogICAgICAgICAgY29uc29sZS5sb2coIlN1Y2Nlc3N8IiArIHBheWxvYWQuc2VxICsgIjtsYXRlbmN5PSIgKyAocGVyZm9ybWFuY2Uubm93KCkgLSBzdGFydCkpOyAvLyBUT0RPOiBncmFwaCBpdA0KICAgICAgICB9LA0KICAgICAgICBmYWlsdXJlOiBmdW5jdGlvbihyZWFzb24pIHsNCiAgICAgICAgICBzaWduYWwodHJ1ZSk7DQogICAgICAgICAgY29uc29sZS5sb2coIkZBSUxVUkUgVE8gU0VORDogIiArIHJlYXNvbik7IC8vIFRPRE86IGxvZyBpdA0KICAgICAgICB9DQogICAgICB9KTsNCiAgICB9Ow0KICB9Ow0KDQogIHdpbmRvdy5yeGh0bWwgPSBzZWxmOw0KICByZXR1cm4gc2VsZjsNCn0pKCk7");
}
